/*! Protein Feature View. proteinfeatureview 1.0.1  16y-08-08 */
var requirejs,require,define;!function(ba){function G(a){return"[object Function]"===K.call(a)}function H(a){return"[object Array]"===K.call(a)}function v(a,b){if(a){var c;for(c=0;c<a.length&&(!a[c]||!b(a[c],c,a));c+=1);}}function T(a,b){if(a){var c;for(c=a.length-1;c>-1&&(!a[c]||!b(a[c],c,a));c-=1);}}function t(a,b){return fa.call(a,b)}function m(a,b){return t(a,b)&&a[b]}function B(a,b){for(var c in a)if(t(a,c)&&b(a[c],c))break}function U(a,b,c,d){return b&&B(b,function(b,e){(c||!t(a,e))&&(!d||"object"!=typeof b||!b||H(b)||G(b)||b instanceof RegExp?a[e]=b:(a[e]||(a[e]={}),U(a[e],b,c,d)))}),a}function u(a,b){return function(){return b.apply(a,arguments)}}function ca(a){throw a}function da(a){if(!a)return a;var b=ba;return v(a.split("."),function(a){b=b[a]}),b}function C(a,b,c,d){return b=Error(b+"\nhttp://requirejs.org/docs/errors.html#"+a),b.requireType=a,b.requireModules=d,c&&(b.originalError=c),b}function ga(a){function b(a,b,c){var d,e,f,g,h,i,j,k,b=b&&b.split("/"),l=D.map,n=l&&l["*"];if(a){for(a=a.split("/"),e=a.length-1,D.nodeIdCompat&&Q.test(a[e])&&(a[e]=a[e].replace(Q,"")),"."===a[0].charAt(0)&&b&&(e=b.slice(0,b.length-1),a=e.concat(a)),e=a,f=0;f<e.length;f++)g=e[f],"."===g?(e.splice(f,1),f-=1):".."===g&&0!==f&&(1!=f||".."!==e[2])&&".."!==e[f-1]&&f>0&&(e.splice(f-1,2),f-=2);a=a.join("/")}if(c&&l&&(b||n)){e=a.split("/"),f=e.length;a:for(;f>0;f-=1){if(h=e.slice(0,f).join("/"),b)for(g=b.length;g>0;g-=1)if((c=m(l,b.slice(0,g).join("/")))&&(c=m(c,h))){d=c,i=f;break a}!j&&n&&m(n,h)&&(j=m(n,h),k=f)}!d&&j&&(d=j,i=k),d&&(e.splice(0,i,d),a=e.join("/"))}return(d=m(D.pkgs,a))?d:a}function c(a){z&&v(document.getElementsByTagName("script"),function(b){return b.getAttribute("data-requiremodule")===a&&b.getAttribute("data-requirecontext")===x.contextName?(b.parentNode.removeChild(b),!0):void 0})}function d(a){var b=m(D.paths,a);return b&&H(b)&&1<b.length?(b.shift(),x.require.undef(a),x.makeRequire(null,{skipMap:!0})([a]),!0):void 0}function e(a){var b,c=a?a.indexOf("!"):-1;return c>-1&&(b=a.substring(0,c),a=a.substring(c+1,a.length)),[b,a]}function f(a,c,d,f){var g,h,i=null,j=c?c.name:null,k=a,l=!0,n="";return a||(l=!1,a="_@r"+(P+=1)),a=e(a),i=a[0],a=a[1],i&&(i=b(i,j,f),h=m(K,i)),a&&(i?n=h&&h.normalize?h.normalize(a,function(a){return b(a,j,f)}):-1===a.indexOf("!")?b(a,j,f):a:(n=b(a,j,f),a=e(n),i=a[0],n=a[1],d=!0,g=x.nameToUrl(n))),d=!i||h||d?"":"_unnormalized"+(S+=1),{prefix:i,name:n,parentMap:c,unnormalized:!!d,url:g,originalName:k,isDefine:l,id:(i?i+"!"+n:n)+d}}function h(a){var b=a.id,c=m(E,b);return c||(c=E[b]=new x.Module(a)),c}function i(a,b,c){var d=a.id,e=m(E,d);!t(K,d)||e&&!e.defineEmitComplete?(e=h(a),e.error&&"error"===b?c(e.error):e.on(b,c)):"defined"===b&&c(K[d])}function j(a,b){var c=a.requireModules,d=!1;b?b(a):(v(c,function(b){(b=m(E,b))&&(b.error=a,b.events.error&&(d=!0,b.emit("error",a)))}),d||g.onError(a))}function k(){R.length&&(ha.apply(J,[J.length,0].concat(R)),R=[])}function l(a){delete E[a],delete F[a]}function n(a,b,c){var d=a.map.id;a.error?a.emit("error",a.error):(b[d]=!0,v(a.depMaps,function(d,e){var f=d.id,g=m(E,f);g&&!a.depMatched[e]&&!c[f]&&(m(b,f)?(a.defineDep(e,K[f]),a.check()):n(g,b,c))}),c[d]=!0)}function o(){var a,b,e=(a=1e3*D.waitSeconds)&&x.startTime+a<(new Date).getTime(),f=[],g=[],h=!1,i=!0;if(!s){if(s=!0,B(F,function(a){var j=a.map,k=j.id;if(a.enabled&&(j.isDefine||g.push(a),!a.error))if(!a.inited&&e)d(k)?h=b=!0:(f.push(k),c(k));else if(!a.inited&&a.fetched&&j.isDefine&&(h=!0,!j.prefix))return i=!1}),e&&f.length)return a=C("timeout","Load timeout for modules: "+f,null,f),a.contextName=x.contextName,j(a);i&&v(g,function(a){n(a,{},{})}),e&&!b||!h||!z&&!ea||A||(A=setTimeout(function(){A=0,o()},50)),s=!1}}function p(a){t(K,a[0])||h(f(a[0],null,!0)).init(a[1],a[2])}function q(a){var a=a.currentTarget||a.srcElement,b=x.onScriptLoad;return a.detachEvent&&!Y?a.detachEvent("onreadystatechange",b):a.removeEventListener("load",b,!1),b=x.onScriptError,(!a.detachEvent||Y)&&a.removeEventListener("error",b,!1),{node:a,id:a&&a.getAttribute("data-requiremodule")}}function r(){var a;for(k();J.length;){if(a=J.shift(),null===a[0])return j(C("mismatch","Mismatched anonymous define() module: "+a[a.length-1]));p(a)}}var s,w,x,y,A,D={waitSeconds:7,baseUrl:"./",paths:{},bundles:{},pkgs:{},shim:{},config:{}},E={},F={},I={},J=[],K={},L={},O={},P=1,S=1;return y={require:function(a){return a.require?a.require:a.require=x.makeRequire(a.map)},exports:function(a){return a.usingExports=!0,a.map.isDefine?a.exports?K[a.map.id]=a.exports:a.exports=K[a.map.id]={}:void 0},module:function(a){return a.module?a.module:a.module={id:a.map.id,uri:a.map.url,config:function(){return m(D.config,a.map.id)||{}},exports:a.exports||(a.exports={})}}},w=function(a){this.events=m(I,a.id)||{},this.map=a,this.shim=m(D.shim,a.id),this.depExports=[],this.depMaps=[],this.depMatched=[],this.pluginMaps={},this.depCount=0},w.prototype={init:function(a,b,c,d){d=d||{},this.inited||(this.factory=b,c?this.on("error",c):this.events.error&&(c=u(this,function(a){this.emit("error",a)})),this.depMaps=a&&a.slice(0),this.errback=c,this.inited=!0,this.ignore=d.ignore,d.enabled||this.enabled?this.enable():this.check())},defineDep:function(a,b){this.depMatched[a]||(this.depMatched[a]=!0,this.depCount-=1,this.depExports[a]=b)},fetch:function(){if(!this.fetched){this.fetched=!0,x.startTime=(new Date).getTime();var a=this.map;if(!this.shim)return a.prefix?this.callPlugin():this.load();x.makeRequire(this.map,{enableBuildCallback:!0})(this.shim.deps||[],u(this,function(){return a.prefix?this.callPlugin():this.load()}))}},load:function(){var a=this.map.url;L[a]||(L[a]=!0,x.load(this.map.id,a))},check:function(){if(this.enabled&&!this.enabling){var a,b,c=this.map.id;b=this.depExports;var d=this.exports,e=this.factory;if(this.inited){if(this.error)this.emit("error",this.error);else if(!this.defining){if(this.defining=!0,1>this.depCount&&!this.defined){if(G(e)){if(this.events.error&&this.map.isDefine||g.onError!==ca)try{d=x.execCb(c,e,b,d)}catch(f){a=f}else d=x.execCb(c,e,b,d);if(this.map.isDefine&&void 0===d&&((b=this.module)?d=b.exports:this.usingExports&&(d=this.exports)),a)return a.requireMap=this.map,a.requireModules=this.map.isDefine?[this.map.id]:null,a.requireType=this.map.isDefine?"define":"require",j(this.error=a)}else d=e;this.exports=d,this.map.isDefine&&!this.ignore&&(K[c]=d,g.onResourceLoad)&&g.onResourceLoad(x,this.map,this.depMaps),l(c),this.defined=!0}this.defining=!1,this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=!0)}}else this.fetch()}},callPlugin:function(){var a=this.map,c=a.id,d=f(a.prefix);this.depMaps.push(d),i(d,"defined",u(this,function(d){var e,k;k=m(O,this.map.id);var n=this.map.name,o=this.map.parentMap?this.map.parentMap.name:null,p=x.makeRequire(a.parentMap,{enableBuildCallback:!0});this.map.unnormalized?(d.normalize&&(n=d.normalize(n,function(a){return b(a,o,!0)})||""),d=f(a.prefix+"!"+n,this.map.parentMap),i(d,"defined",u(this,function(a){this.init([],function(){return a},null,{enabled:!0,ignore:!0})})),(k=m(E,d.id))&&(this.depMaps.push(d),this.events.error&&k.on("error",u(this,function(a){this.emit("error",a)})),k.enable())):k?(this.map.url=x.nameToUrl(k),this.load()):(e=u(this,function(a){this.init([],function(){return a},null,{enabled:!0})}),e.error=u(this,function(a){this.inited=!0,this.error=a,a.requireModules=[c],B(E,function(a){0===a.map.id.indexOf(c+"_unnormalized")&&l(a.map.id)}),j(a)}),e.fromText=u(this,function(b,d){var i=a.name,k=f(i),l=M;d&&(b=d),l&&(M=!1),h(k),t(D.config,c)&&(D.config[i]=D.config[c]);try{g.exec(b)}catch(m){return j(C("fromtexteval","fromText eval for "+c+" failed: "+m,m,[c]))}l&&(M=!0),this.depMaps.push(k),x.completeLoad(i),p([i],e)}),d.load(a.name,p,e,D))})),x.enable(d,this),this.pluginMaps[d.id]=d},enable:function(){F[this.map.id]=this,this.enabling=this.enabled=!0,v(this.depMaps,u(this,function(a,b){var c,d;if("string"==typeof a){if(a=f(a,this.map.isDefine?this.map:this.map.parentMap,!1,!this.skipMap),this.depMaps[b]=a,c=m(y,a.id))return void(this.depExports[b]=c(this));this.depCount+=1,i(a,"defined",u(this,function(a){this.defineDep(b,a),this.check()})),this.errback&&i(a,"error",u(this,this.errback))}c=a.id,d=E[c],!t(y,c)&&d&&!d.enabled&&x.enable(a,this)})),B(this.pluginMaps,u(this,function(a){var b=m(E,a.id);b&&!b.enabled&&x.enable(a,this)})),this.enabling=!1,this.check()},on:function(a,b){var c=this.events[a];c||(c=this.events[a]=[]),c.push(b)},emit:function(a,b){v(this.events[a],function(a){a(b)}),"error"===a&&delete this.events[a]}},x={config:D,contextName:a,registry:E,defined:K,urlFetched:L,defQueue:J,Module:w,makeModuleMap:f,nextTick:g.nextTick,onError:j,configure:function(a){a.baseUrl&&"/"!==a.baseUrl.charAt(a.baseUrl.length-1)&&(a.baseUrl+="/");var b=D.shim,c={paths:!0,bundles:!0,config:!0,map:!0};B(a,function(a,b){c[b]?(D[b]||(D[b]={}),U(D[b],a,!0,!0)):D[b]=a}),a.bundles&&B(a.bundles,function(a,b){v(a,function(a){a!==b&&(O[a]=b)})}),a.shim&&(B(a.shim,function(a,c){H(a)&&(a={deps:a}),!a.exports&&!a.init||a.exportsFn||(a.exportsFn=x.makeShimExports(a)),b[c]=a}),D.shim=b),a.packages&&v(a.packages,function(a){var b,a="string"==typeof a?{name:a}:a;b=a.name,a.location&&(D.paths[b]=a.location),D.pkgs[b]=a.name+"/"+(a.main||"main").replace(ia,"").replace(Q,"")}),B(E,function(a,b){!a.inited&&!a.map.unnormalized&&(a.map=f(b))}),(a.deps||a.callback)&&x.require(a.deps||[],a.callback)},makeShimExports:function(a){return function(){var b;return a.init&&(b=a.init.apply(ba,arguments)),b||a.exports&&da(a.exports)}},makeRequire:function(d,e){function i(b,c,k){var l,m;return e.enableBuildCallback&&c&&G(c)&&(c.__requireJsBuild=!0),"string"==typeof b?G(c)?j(C("requireargs","Invalid require call"),k):d&&t(y,b)?y[b](E[d.id]):g.get?g.get(x,b,d,i):(l=f(b,d,!1,!0),l=l.id,t(K,l)?K[l]:j(C("notloaded",'Module name "'+l+'" has not been loaded yet for context: '+a+(d?"":". Use require([])")))):(r(),x.nextTick(function(){r(),m=h(f(null,d)),m.skipMap=e.skipMap,m.init(b,c,k,{enabled:!0}),o()}),i)}return e=e||{},U(i,{isBrowser:z,toUrl:function(a){var c,e=a.lastIndexOf("."),f=a.split("/")[0];return-1!==e&&("."!==f&&".."!==f||e>1)&&(c=a.substring(e,a.length),a=a.substring(0,e)),x.nameToUrl(b(a,d&&d.id,!0),c,!0)},defined:function(a){return t(K,f(a,d,!1,!0).id)},specified:function(a){return a=f(a,d,!1,!0).id,t(K,a)||t(E,a)}}),d||(i.undef=function(a){k();var b=f(a,d,!0),e=m(E,a);c(a),delete K[a],delete L[b.url],delete I[a],T(J,function(b,c){b[0]===a&&J.splice(c,1)}),e&&(e.events.defined&&(I[a]=e.events),l(a))}),i},enable:function(a){m(E,a.id)&&h(a).enable()},completeLoad:function(a){var b,c,e=m(D.shim,a)||{},f=e.exports;for(k();J.length;){if(c=J.shift(),null===c[0]){if(c[0]=a,b)break;b=!0}else c[0]===a&&(b=!0);p(c)}if(c=m(E,a),!b&&!t(K,a)&&c&&!c.inited){if(D.enforceDefine&&(!f||!da(f)))return d(a)?void 0:j(C("nodefine","No define call for "+a,null,[a]));p([a,e.deps||[],e.exportsFn])}o()},nameToUrl:function(a,b,c){var d,e,f;if((d=m(D.pkgs,a))&&(a=d),d=m(O,a))return x.nameToUrl(d,b,c);if(g.jsExtRegExp.test(a))d=a+(b||"");else{for(d=D.paths,a=a.split("/"),e=a.length;e>0;e-=1)if(f=a.slice(0,e).join("/"),f=m(d,f)){H(f)&&(f=f[0]),a.splice(0,e,f);break}d=a.join("/"),d+=b||(/^data\:|\?/.test(d)||c?"":".js"),d=("/"===d.charAt(0)||d.match(/^[\w\+\.\-]+:/)?"":D.baseUrl)+d}return D.urlArgs?d+((-1===d.indexOf("?")?"?":"&")+D.urlArgs):d},load:function(a,b){g.load(x,a,b)},execCb:function(a,b,c,d){return b.apply(d,c)},onScriptLoad:function(a){("load"===a.type||ja.test((a.currentTarget||a.srcElement).readyState))&&(N=null,a=q(a),x.completeLoad(a.id))},onScriptError:function(a){var b=q(a);return d(b.id)?void 0:j(C("scripterror","Script error for: "+b.id,a,[b.id]))}},x.require=x.makeRequire(),x}var g,x,y,D,I,E,N,J,s,O,ka=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/gm,la=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,Q=/\.js$/,ia=/^\.\//;x=Object.prototype;var K=x.toString,fa=x.hasOwnProperty,ha=Array.prototype.splice,z=!("undefined"==typeof window||"undefined"==typeof navigator||!window.document),ea=!z&&"undefined"!=typeof importScripts,ja=z&&"PLAYSTATION 3"===navigator.platform?/^complete$/:/^(complete|loaded)$/,Y="undefined"!=typeof opera&&"[object Opera]"===opera.toString(),F={},q={},R=[],M=!1;if("undefined"==typeof define){if("undefined"!=typeof requirejs){if(G(requirejs))return;q=requirejs,requirejs=void 0}"undefined"!=typeof require&&!G(require)&&(q=require,require=void 0),g=requirejs=function(a,b,c,d){var e,f="_";return!H(a)&&"string"!=typeof a&&(e=a,H(b)?(a=b,b=c,c=d):a=[]),e&&e.context&&(f=e.context),(d=m(F,f))||(d=F[f]=g.s.newContext(f)),e&&d.configure(e),d.require(a,b,c)},g.config=function(a){return g(a)},g.nextTick="undefined"!=typeof setTimeout?function(a){setTimeout(a,4)}:function(a){a()},require||(require=g),g.version="2.1.15",g.jsExtRegExp=/^\/|:|\?|\.js$/,g.isBrowser=z,x=g.s={contexts:F,newContext:ga},g({}),v(["toUrl","undef","defined","specified"],function(a){g[a]=function(){var b=F._;return b.require[a].apply(b,arguments)}}),z&&(y=x.head=document.getElementsByTagName("head")[0],D=document.getElementsByTagName("base")[0])&&(y=x.head=D.parentNode),g.onError=ca,g.createNode=function(a){var b=a.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script");return b.type=a.scriptType||"text/javascript",b.charset="utf-8",b.async=!0,b},g.load=function(a,b,c){var d=a&&a.config||{};if(z)return d=g.createNode(d,b,c),d.setAttribute("data-requirecontext",a.contextName),d.setAttribute("data-requiremodule",b),!d.attachEvent||d.attachEvent.toString&&0>d.attachEvent.toString().indexOf("[native code")||Y?(d.addEventListener("load",a.onScriptLoad,!1),d.addEventListener("error",a.onScriptError,!1)):(M=!0,d.attachEvent("onreadystatechange",a.onScriptLoad)),d.src=c,J=d,D?y.insertBefore(d,D):y.appendChild(d),J=null,d;if(ea)try{importScripts(c),a.completeLoad(b)}catch(e){a.onError(C("importscripts","importScripts failed for "+b+" at "+c,e,[b]))}},z&&!q.skipDataMain&&T(document.getElementsByTagName("script"),function(a){return y||(y=a.parentNode),(I=a.getAttribute("data-main"))?(s=I,q.baseUrl||(E=s.split("/"),s=E.pop(),O=E.length?E.join("/")+"/":"./",q.baseUrl=O),s=s.replace(Q,""),g.jsExtRegExp.test(s)&&(s=I),q.deps=q.deps?q.deps.concat(s):[s],!0):void 0}),define=function(a,b,c){var d,e;"string"!=typeof a&&(c=b,b=a,a=null),H(b)||(c=b,b=null),!b&&G(c)&&(b=[],c.length&&(c.toString().replace(ka,"").replace(la,function(a,c){b.push(c)}),b=(1===c.length?["require"]:["require","exports","module"]).concat(b))),M&&((d=J)||(N&&"interactive"===N.readyState||T(document.getElementsByTagName("script"),function(a){return"interactive"===a.readyState?N=a:void 0}),d=N),d&&(a||(a=d.getAttribute("data-requiremodule")),e=F[d.getAttribute("data-requirecontext")])),(e?e.defQueue:R).push([a,b,c])},define.amd={jQuery:!0},g.exec=function(b){return eval(b)},g(q)}}(this),define("vendor/require.js",function(){}),define("colors",[],function(){"use strict";var a={};a.rgb={};var b=a.rgb;a.rgb.fromValues=function(a,b,c,d){var e=new Array(4);return e[0]=a,e[1]=b,e[2]=c,e[3]=d,e},a.rgb.mix=function(a,b,c,d){var e=1-d;return a[0]=b[0]*d+c[0]*e,a[1]=b[1]*d+c[1]*e,a[2]=b[2]*d+c[2]*e,a[3]=b[3]*d+c[3]*e,a},a.rgb.hex2rgb=function(a){var c,d,e,f;if(4===a.length||5===a.length){c=parseInt(a[1],16),d=parseInt(a[2],16),e=parseInt(a[3],16),f=15,5===a.length&&(f=parseInt(a[4],16));var g=1/15;return b.fromValues(g*c,g*d,g*e,g*f)}if(7===a.length||9===a.length){c=parseInt(a.substr(1,2),16),d=parseInt(a.substr(3,2),16),e=parseInt(a.substr(5,2),16),f=255,9===a.length&&(f=parseInt(a.substr(7,2),16));var h=1/255;return b.fromValues(h*c,h*d,h*e,h*f)}};var c={white:b.fromValues(1,1,1,1),black:b.fromValues(0,0,0,1),grey:b.fromValues(.5,.5,.5,1),lightgrey:b.fromValues(.8,.8,.8,1),darkgrey:b.fromValues(.3,.3,.3,1),red:b.hex2rgb("#AA00A2"),darkred:b.hex2rgb("#7F207B"),lightred:b.fromValues(1,.5,.5,1),green:b.hex2rgb("#C9F600"),darkgreen:b.hex2rgb("#9FB82E"),lightgreen:b.hex2rgb("#E1FA71"),blue:b.hex2rgb("#6A93D4"),darkblue:b.hex2rgb("#284A7E"),lightblue:b.fromValues(.5,.5,1,1),yellow:b.hex2rgb("#FFCC73"),darkyellow:b.fromValues(.5,.5,0,1),lightyellow:b.fromValues(1,1,.5,1),cyan:b.fromValues(0,1,1,1),darkcyan:b.fromValues(0,.5,.5,1),lightcyan:b.fromValues(.5,1,1,1),magenta:b.fromValues(1,0,1,1),darkmagenta:b.fromValues(.5,0,.5,1),lightmagenta:b.fromValues(1,.5,1,1),orange:b.hex2rgb("#FFA200"),darkorange:b.fromValues(.5,.25,0,1),lightorange:b.fromValues(1,.75,.5,1),brown:b.hex2rgb("#A66A00"),purple:b.hex2rgb("#D435CD")},d=[{color:"#f0f0f0",darkercolor:"#c0c0c0",lightercolor:"#ffffff",textcolor:"black"},{color:"#d9d9d9",darkercolor:"#aeaeae",lightercolor:"#ffffff",textcolor:"black"},{color:"#bdbdbd",darkercolor:"#979797",lightercolor:"#ffffff",textcolor:"black"},{color:"#969696",darkercolor:"#787878",lightercolor:"#ffffff",textcolor:"black"},{color:"#737373",darkercolor:"#5c5c5c",lightercolor:"#c4c4c4",textcolor:"white"},{color:"#525252",darkercolor:"#424242",lightercolor:"#8b8b8b",textcolor:"white"},{color:"#252525",darkercolor:"#1e1e1e",lightercolor:"#3f3f3f",textcolor:"white"}],e=[{color:"#a6cee3",darkercolor:"#85a5b6",lightercolor:"#ffffff",textcolor:"black"},{color:"#1f78b4",darkercolor:"#196090",lightercolor:"#35ccff",textcolor:"white"},{color:"#b2df8a",darkercolor:"#8eb26e",lightercolor:"#ffffeb",textcolor:"black"},{color:"#33a02c",darkercolor:"#298023",lightercolor:"#57ff4b",textcolor:"black"},{color:"#fb9a99",darkercolor:"#c97b7a",lightercolor:"#ffffff",textcolor:"black"},{color:"#e31a1c",darkercolor:"#b61516",lightercolor:"#ff2c30",textcolor:"black"},{color:"#fdbf6f",darkercolor:"#ca9959",lightercolor:"#ffffbd",textcolor:"black"},{color:"#ff7f00",darkercolor:"#cc6600",lightercolor:"#ffd800",textcolor:"black"},{color:"#cab2d6",darkercolor:"#a28eab",lightercolor:"#ffffff",textcolor:"black"},{color:"#6a3d9a",darkercolor:"#55317b",lightercolor:"#b468ff",textcolor:"white"}],f=[{color:"#d73027",darkercolor:"#ac261f",lightercolor:"#ff5242",textcolor:"white"},{color:"#f46d43",darkercolor:"#c35736",lightercolor:"#ffb972",textcolor:"black"},{color:"#abd9e9",darkercolor:"#89aeba",lightercolor:"#ffffff",textcolor:"black"},{color:"#74add1",darkercolor:"#5d8aa7",lightercolor:"#c5ffff",textcolor:"black"}],g=[{color:"#ff7f00",darkercolor:"#cc6600",lightercolor:"#ffd800",textcolor:"black"}];return a.rgb.getBWPalette=function(){return d},a.rgb.getPairedColorPalette=function(){return e},a.rgb.getRedBluePalette=function(){return f},a.rgb.getDomainColors=function(){return g},a.rgb.componentToHex=function(a){var b=a.toString(16);return 1===b.length?"0"+b:b},a.rgb.rgb2hex=function(b){if(3===b.length){var c=b[0],d=b[1],e=b[2];return"#"+a.rgb.componentToHex(c)+a.rgb.componentToHex(d)+a.rgb.componentToHex(e)}if(4===b.length||5===b.length){var f=b[0],g=b[1],h=b[2],i=15;return 4===b.length&&(i=b[3]),"#"+a.rgb.componentToHex(255*f)+a.rgb.componentToHex(255*g)+a.rgb.componentToHex(255*h)}return"#000000"},a.shadeRGBColor=function(a,b){var c=a,d=0>b?0:255,e=0>b?-1*b:b,f=parseInt(c[0]),g=parseInt(c[1]),h=parseInt(c[2]);return"rgb("+(Math.round((d-f)*e)+f)+","+(Math.round((d-g)*e)+g)+","+(Math.round((d-h)*e)+h)+")"},a.blendRGBColors=function(a,b,c){var d=a.split(","),e=b.split(","),f=parseInt(d[0].slice(4)),g=parseInt(d[1]),h=parseInt(d[2]);return"rgb("+(Math.round((parseInt(e[0].slice(4))-f)*c)+f)+","+(Math.round((parseInt(e[1])-g)*c)+g)+","+(Math.round((parseInt(e[2])-h)*c)+h)+")"},a.setColorPalette=function(b){c=b,a.initGradients()},a.forceRGB=function(b){if("string"==typeof b){var d=c[b];if(void 0!==d)return d;if(b.length>0&&"#"===b[0])return a.hex2rgb(b)}return 3===b.length?[b[0],b[1],b[2],1]:b},a.forceHex=function(b){var d=c[b];return void 0!==d?a.rgb.rgb2hex(d):void 0},a}),define("params",["colors"],function(a){function b(){this.textLeft=20,this.leftBorder=130,this.bottomBorder=15,this.trackHeight=10,this.trackHeightCharts=20,this.rightBorder=10,this.maxTracksSingleMode=10,this.maxTextSize=10,this.scale=-1,this.y=0,this.maxY=0,this.baseLineHeight=3,this.bw_colors=a.rgb.getBWPalette(),this.paired_colors=a.rgb.getPairedColorPalette(),this.domain_colors=a.rgb.getDomainColors(),this.redblue_colors=a.rgb.getRedBluePalette().reverse(),this.customColors=[],this.customColors.push(this.paired_colors[0]),this.customColors.push(this.paired_colors[1]),this.customColors.push(this.paired_colors[8]),this.customColors.push(this.paired_colors[9]),this.homColors=[],this.homColors.push(this.paired_colors[5]),this.homColors.push(this.paired_colors[4]),this.up_colors=[],this.up_colors.push(this.paired_colors[2]),this.up_colors.push(this.paired_colors[3]),this.expressionTagColor=a.rgb.getDomainColors()[0],this.conflictColor=a.rgb.getRedBluePalette()[a.rgb.getRedBluePalette().length-1],this.deletionColor=this.paired_colors[6]}return{Params:function(){return new b}}}),define("icons",[],function(){function a(){this.eye="m 1664,576 q -152,236 -381,353 61,-104 61,-225 0,-185 -131.5,-316.5 Q 1081,256 896,256 711,256 579.5,387.5 448,519 448,704 448,825 509,929 280,812 128,576 261,371 461.5,249.5 662,128 896,128 1130,128 1330.5,249.5 1531,371 1664,576 z M 944,960 q 0,20 -14,34 -14,14 -34,14 -125,0 -214.5,-89.5 Q 592,829 592,704 q 0,-20 14,-34 14,-14 34,-14 20,0 34,14 14,14 14,34 0,86 61,147 61,61 147,61 20,0 34,14 14,14 14,34 z m 848,-384 q 0,-34 -20,-69 Q 1632,277 1395.5,138.5 1159,0 896,0 633,0 396.5,139 160,278 20,507 0,542 0,576 q 0,34 20,69 140,229 376.5,368 236.5,139 499.5,139 263,0 499.5,-139 236.5,-139 376.5,-368 20,-35 20,-69 z"}return{Icons:function(){return new a}}}),define("popups",[],function(){function a(){}return a.prototype.init=function(a,b){this.viewer=a,this.rcsbServer=b},a.prototype.showSequenceDialog=function(a){var b=this.viewer.data,c=this.viewer.getSVGWrapper(),d=$(c.root()).offset(),e=a.pageX-d.left,f=this.viewer.drawer.screen2Seq(e)-1;f>this.viewer.data.sequence.length&&(f=-1);var g=this.viewer.getPdbPositions(f);"undefined"!=typeof pageTracker&&pageTracker._trackEvent("ProteinFeatureView","showSequenceDialog",b.uniprotID);var h="";h+=this.viewer.showPdb3dLinks(g),this.viewer.singlePDBmode?(h+="<h3>"+b.uniprotID+"-"+b.name+"</h3>",h+="Show All <a href='"+this.rcsbServer+"/pdb/protein/"+b.uniprotID+"'>PDB-UniProtKB mappings</a> that are available for "+b.uniprotID):(h+="<h3>Search RCSB PDB</h3>",h+="<ul><li><a href='"+this.rcsbServer+"/pdb/search/smartSubquery.do?smartSearchSubtype=UpAccessionIdQuery&accessionIdList="+b.uniprotID+"'>Show All PDB chains</a> that are linked to UniProtKB ID <b>"+b.uniprotID+"</b> - "+b.name+' ?</li> <li>View UniProtKB record for <a href="http://www.uniprot.org/uniprot/'+b.uniprotID+'"  target="_new">'+b.uniprotID+"<span class='iconSet-main icon-external'> &nbsp;</span></a></li>",h+="</ul>");var i=b.uniprotID+" - "+b.name,j="",k="";this.viewer.doModal(this.viewer.dialogDiv,i,h,j,k),this.viewer.registerPdb3dLinks(g)},a.prototype.blastPopup=function(a,b,c,d,e,f){var g="";g+=this.viewer.showPdb3dLinks(f,"blast"),g+="<h3>Search RCSB PDB</h3>",g+="<ul>","undefined"!=typeof pageTracker&&pageTracker._trackEvent("ProteinFeatureView","showUniProtDialog",e);var h=this.rcsbServer+"/pdb/search/smart.do?chainId_0=&eCutOff_0=0.001&maskLowComplexity_0=yes&searchTool_0=blast&smartComparator=and&smartSearchSubtype_0=SequenceQuery&structureId_0=&target=Current&sequence_0=";if(g+="<li>Perform a <a href='"+h+a+"'>Blast sequence search against PDB</a> using this sequence region.</li>","undefined"!=typeof b){var i=d;"undefined"!=typeof c&&(i="Show "+c+" PDB entries that contain "+d+" from "+this.viewer.data.uniprotID),g+='<li><a href="'+b+'">'+i+"</a></li>"}return g+="</ul>"},a.prototype.sequenceMotifPopup=function(a,b,c){var d="";d+=this.viewer.showPdb3dLinks(c),d+="<h3>"+b+"</h3>",d+="<ul>","undefined"!=typeof pageTracker&&pageTracker._trackEvent("ProteinFeatureView","showSeqMotifDialog",b);var e=this.rcsbServer+"/pdb/search/smart.do?&smartSearchSubtype_0=MotifQuery&target=Current&motif_0=";return d+="<li>Perform a <a href='"+e+a+"'>Sequence Motif Search</a>.</li>",d+="</ul>"},a.prototype.clickUpSiteMethod=function(a,b){var c=b.target||b.toElement,d=c.title;"undefined"==typeof d&&(d=$(c).attr("data-original-title")),"undefined"!=typeof pageTracker&&pageTracker._trackEvent("ProteinFeatureView","clickUPSite",this.viewer.data.uniprotID);var e=d,f=this.viewer.getPdbPositions(a.start-1,a.end-1);e+=this.viewer.showPdb3dLinks(f);var g="UP Sites",h="",i="";this.viewer.doModal(this.viewer.dialogDiv,g,e,h,i),this.viewer.registerPdb3dLinks(f)},a.prototype.clickPhosphoMethod=function(a,b){var c=b.target||b.toElement,d=c.title;"undefined"==typeof d&&(d=$(c).attr("data-original-title"));var e=d;this.viewer.highlight(a.start-1,a.end-1);var f=this.viewer.getPdbPositions(a.start-1,a.end-1);e+=this.viewer.showPdb3dLinks(f),"undefined"!=typeof pageTracker&&pageTracker._trackEvent("ProteinFeatureView","clickPhosphoSite",this.viewer.data.uniprotID),e+="<h3>PhosphoSitePlus</h3>",e+="<ul>";var g="http://www.phosphosite.org/proteinSearchSubmitAction.do?accessionIds="+this.viewer.data.uniprotID;e+="<li>Show at <a target='_new'' href='"+g+"'>PhosphoSitePlus website</a></li>",e+="</ul>";var h="Phosphosite",i="",j="";this.viewer.doModal(this.viewer.dialogDiv,h,e,i,j),this.viewer.registerPdb3dLinks(f)},a.prototype.callbackec=function(a){var b="http://www.brenda-enzymes.org/php/result_flat.php4?ecno=",c=this.viewer.rcsbServer+"/pdb/search/smartSubquery.do?smartSearchSubtype=EnzymeClassificationQuery&Enzyme_Classification=",d="<h3>"+a.name+" - "+a.desc+"</h3>";d+="<ul><li>View in <a href='"+b+a.name+"' target='_new'>BRENDA</a></li>",d+="<li>View <a href='"+c+a.name+"'>other PDB entries with the same E.C. number</a></li>",d+="</ul>","undefined"!=typeof pageTracker&&pageTracker._trackEvent("ProteinFeatureView","showECDialog",a.name);var e=a.name+" - "+a.desc,f="",g="";this.viewer.doModal(this.viewer.dialogDiv,e,d,f,g)},a.prototype.callbackSecStruc=function(a){var b=a.name;a.name!==a.desc&&(b+=" - "+a.desc);var c=this.viewer.getPdbPositions(a.start,a.end),d=this.viewer.showPdb3dLinks(c,"secstruc"),e="<h1>"+b+"</h1>",f="",g="";this.viewer.doModal(this.viewer.dialogDiv,e,d,f,g),this.viewer.registerPdb3dLinks(c,"secstruc")},a.prototype.callbackUniProtFeature=function(a){var b=a.name;a.name!==a.desc&&(b+=" - "+a.desc);var c=this.viewer.getPdbPositions(a.start-1,a.end-1),d="";if("short sequence motif"===a.name){var e=a.desc.split(" ");2===e.length&&(d=this.popup.sequenceMotifPopup(e[0],b,a.start,a.end))}if(""===d){var f=this.viewer.getData().sequence.substr(a.start,a.end-a.start+1);d=this.popups.blastPopup(f,a.url,a.hits,a.desc,b,c)}var g="<h1>"+b+"</h1>",h="",i="";this.viewer.doModal(this.viewer.dialogDiv,g,d,h,i),this.viewer.registerPdb3dLinks(c,"blast")},a.prototype.scopcallback=function(a){var b=a.name;a.name!==a.desc&&(b+=" - "+a.desc,"undefined"!=typeof a.note&&(b+=" ("+a.note+")"));var c="",d=this.viewer.getPdbPositions(a.start-1,a.end-1);c+=this.viewer.showPdb3dLinks(d,"scop"),c+="<h3>"+b+"</h3>",c+="<ul>","undefined"!=typeof pageTracker&&pageTracker._trackEvent("ProteinFeatureView","showSCOPeDialog",b);var e="http://scop.mrc-lmb.cam.ac.uk/scop/search.cgi?ver=1.75&key="+a.name;c+="<li>Show at <a target='_new'' href='"+e+"'>SCOP website</a></li>",c+="</ul>";var f=b,g="",h="";this.viewer.doModal(this.viewer.dialogDiv,f,c,g,h),this.viewer.registerPdb3dLinks(d,"scop")},a.prototype.scopecallback=function(){var a=this.name;this.name!==this.desc&&(a+=" - "+this.desc,"undefined"!=typeof this.note&&(a+=" ("+this.note+")"));var b="<h1>"+a+"</h1>";b+="<ul>","undefined"!=typeof pageTracker&&pageTracker._trackEvent("ProteinFeatureView","showSCOPeDialog",a);var c="http://scop.berkeley.edu/sccs="+this.name;b+="<li>Show at <a target='_new'' href='"+c+"'>SCOPe website</a></li>",b+="</ul>";var d=a,e="",f="";this.viewer.doModal(this.viewer.dialogDiv,d,b,e,f)},a.prototype.showPfamDialog=function(a){var b=a.acc,c=a.desc;"undefined"!=typeof pageTracker&&pageTracker._trackEvent("ProteinFeatureView","showPfamDialog",b);var d="",e=this.viewer.getPdbPositions(a.start-1,a.end-1);d+=this.viewer.showPdb3dLinks(e),d+="<h3> "+c+'</h3><ul><li>Go to Pfam site for <a href="http://pfam.sanger.ac.uk/family/'+b+'" target="_new">'+b+"<span class='iconSet-main icon-external'> &nbsp;</span> </a></li>",d+="<li>Find <a href='"+this.rcsbServer+"/pdb/search/smartSubquery.do?smartSearchSubtype=PfamIdQuery&amp;pfamID="+b+"'>other PDB entries with the same Pfam domain</a></li>",d+="</ul>";var f=b+" - "+a.name,g="",h="";this.viewer.doModal(this.viewer.dialogDiv,f,d,g,h),this.viewer.registerPdb3dLinks(e)},a.prototype.showExonDialog=function(a){var b=a.acc,c=a.desc;"undefined"!=typeof pageTracker&&pageTracker._trackEvent("ProteinFeatureView","showExonDialog",b);var d="<h1> Exon "+c+"</h1>",e=this.viewer.getPdbPositions(a.start-1,a.end-1);d+=this.viewer.showPdb3dLinks(e),d+="<h3>RCSB PDB Gene View</h3>",d+='<ul><li>Go to RCSB Gene View for <a href="/pdb/gene/'+b+'" target="_new">'+b+" </a></li>",d+="</ul>";var f=b+" - "+a.name,g="",h="";this.viewer.doModal(this.viewer.dialogDiv,f,d,g,h),this.viewer.registerPdb3dLinks(e)},a.prototype.clickVariationMethod=function(a,b){var c=b.target||b.toElement,d=c.title;"undefined"==typeof d&&(d=$(c).attr("data-original-title")),"undefined"!=typeof pageTracker&&pageTracker._trackEvent("ProteinFeatureView","clickVariationSNP",this.viewer.data.uniprotID);var e=d,f=this.viewer.getPdbPositions(a.start-1,a.end-1);e+=this.viewer.showPdb3dLinks(f);var g=$(c).data("extLinks");if("undefined"!=typeof g&&""!==g&&g.length>0){e+="<ul>";for(var h=0;h<g.length;h++){var i=g[h];"undefined"!=typeof i&&""!==i&&"undefined"!==i.sitename&&""!==i.sitename&&"undefined"!==i.siteurl&&""!==i.siteurl&&(e+="<li>Show at <a target='_new'' href='"+i.siteurl+"'>"+i.sitename+"</a></li>")}e+="</ul>"}var j="Variation",k="",l="";this.viewer.doModal(this.viewer.dialogDiv,j,e,k,l),this.viewer.registerPdb3dLinks(f)},a.prototype.showDialog=function(a,b){if("undefined"!=typeof a){var c=a.pdbID.trim(),d=a.desc;"undefined"!=typeof pageTracker&&pageTracker._trackEvent("ProteinFeatureView","showPDBDialog",d);var e="<span><img width='240' src='"+this.viewer.rcsbServer+"/pdb/images/"+c.toLowerCase()+"_bio_r_250.jpg?getBest=true' /></span>",f=this.viewer.getSVGWrapper(),g=$(f.root()).offset(),h=b.pageX-g.left,i=this.viewer.drawer.screen2Seq(h)-1;i>this.viewer.data.sequence.length&&(i=-1);var j=this.viewer.getPdbPositions(i),k=[],l={};if(l.pdbId=a.pdbID,l.chainId=a.chainID,i>=0)for(var m=0;m<j.length;m++){var n=j[m];if(n.pdbId===l.pdbId&&n.chainId===l.chainId){l=n;break}}k.push(l),e+=this.viewer.showPdb3dLinks(k,"uniprot"),e+="<h3>Search RCSB PDB</h3>",e+="<ul>",e+='<li><a href="'+this.viewer.rcsbServer+"/pdb/explore/explore.do?structureId="+c+'">Structure Summary Page for '+c+"</a></li>",e+="</ul>";var o="View "+c+" - "+d,p="",q="";this.viewer.doModal(this.viewer.dialogDiv,o,e,p,q),this.viewer.registerPdb3dLinks(k,"uniprot")}},{Popups:function(){return new a}}}),define("draw",["params","colors","icons","popups"],function(a,b,c,d){function e(b){this.viewer=b,this.param=new a.Params,this.icons=new c.Icons,this.popups=new d.Popups,this.popups.init(this.viewer,this.viewer.rcsbServer),this.scale=1,this.height=15,this.maxY=0}var f={};return e.prototype.getParams=function(){return this.param},e.prototype.getGroup=function(a){var b=this.viewer.getSVGWrapper(),c=b.group({id:a,"font-family":"Roboto","font-weight":700,fontSize:"10",fill:"black"});return c},e.prototype.seq2Screen=function(a){return this.param.leftBorder+Math.round(a*this.scale)},e.prototype.screen2Seq=function(a){return Math.round((a-this.param.leftBorder)/this.scale)},e.prototype.drawRuler=function(a,b,c){var d=5,e=2;a.rect(this.seq2Screen(0),c,b.length*this.scale,1,{fill:"black"});for(var f=0,g=0;g<b.length;g++)(g+1)%50===0&&(g-f)*this.scale>10*(Math.log(g)/Math.log(10)+1)?(this.drawTick(a,g,c,d),f=g):this.scale>2&&((g+1)%10===0?this.drawTick(a,g,c,e):this.scale>4&&(g+1)%5===0&&a.rect(this.seq2Screen(g),c,1*this.scale,4,{
fill:"black"}),this.scale>8&&a.rect(this.seq2Screen(g),c,1,2,{fill:"black"}));return c+this.param.trackHeight+10},e.prototype.drawName=function(a,b,c,d,e,f){var g=a.text(b,this.param.textLeft+2,c+this.param.trackHeight-1,d,{style:{"font-family":"RobotoSlab, sans-serif;","font-weight":"900"}});"undefined"!=typeof e&&($(g).css("cursor","pointer"),$(g).bind("click",function(a){e(a,d)})),"undefined"!=typeof f&&($(g).attr("title",f),this.registerTooltip(g))},e.prototype.drawSequence=function(a,b,c){var d=this.param.trackHeight+5;this.param.singlePDBmode&&(d-=5);var e=this.getGroup("sequenceTrack"+this.viewer.getData().uniprotID),f=a.group({fill:"lightgrey"}),g=a.group({fill:"#dcdcdc"});this.drawName(a,e,c,b.name,void 0,"UniProtKB sequence "+b.name);var h=a.group({id:"seqpos"+this.viewer.getData().uniprotID,fontWeight:"bold",fontSize:"10",fill:"black"}),i=a.defs();a.linearGradient(i,"sequence"+this.viewer.getData().uniprotID,[["0%","white"],["100%","black"]],0,c,0,c+d,{gradientUnits:"userSpaceOnUse"});var j=a.rect(e,this.seq2Screen(0),c,b.length*this.scale,d,4,4,{fill:"url(#sequence"+this.viewer.getData().uniprotID+")",stroke:"grey",strokeWidth:1}),k="UniProtKB sequence "+b.name+" - "+this.viewer.getData().name+" Length: "+this.viewer.getData().length;$(j).attr("title",k),this.registerTooltip(j),c+=d;var l=b.name+" - "+this.viewer.getData().name+" - "+this.viewer.getData().desc,m=a.text(e,this.seq2Screen(1),c-this.param.trackHeight/2,l,{fill:"black"});if(this.checkTxtLength(m,1,b.length,l),$(m).attr("title",k),this.registerTooltip(m),this.scale>=8){for(var n=0;n<b.length;n++){(n+1)%10===0?a.rect(g,this.seq2Screen(n),c,1*this.scale,10):(n+1)%5===0&&a.rect(f,this.seq2Screen(n),c,1*this.scale,10);var o=a.text(h,this.seq2Screen(n)+1,c+this.param.trackHeight-1,this.viewer.getData().sequence.charAt(n));$(o).attr("title","Sequence position "+(n+1)+" - "+this.viewer.getData().sequence.charAt(n)),this.registerTooltip(o)}c+=this.param.trackHeight}return c+5},e.prototype.drawExpandCondensedSymbol=function(a,b,c,d){var e=a.group({id:"expandCondensed"+this.viewer.getData().uniprotID,fontWeight:"bold",fontSize:"10",fill:"black"}),f=a.rect(e,this.param.textLeft-5,b+1,2,this.param.trackHeight-2,{fill:"black"});b+=this.param.trackHeight;var g=a.createPath();a.path(e,g.move(this.param.textLeft-4,b).line([[this.param.textLeft-6,b-4],[this.param.textLeft-2,b-4]]).close(),{fill:"black",stroke:"black"}),b+=1;var h=a.circle(e,this.param.textLeft-4,b+this.param.trackHeight,8,{fill:"black",opacity:"0.2"}),i=a.text(e,this.param.textLeft-8,b+1.5*this.param.trackHeight-1,"+",{fontSize:"14",fill:"black",fontWeight:"bold"}),j=[];j.push(h),j.push(i),j.push(f);for(var k=0;k<j.length;k++){var l=j[k];this.registerTooltip(l,c),$(l).bind("click",$.proxy(d))}return b+2*this.param.trackHeight+1},e.prototype.drawCollapseCondensedSymbol=function(a,b){var c=a.group({id:"expandCondensed"+this.viewer.getData().uniprotID,fontWeight:"bold",fontSize:"10",fill:"black"});b+=1;var d=a.circle(c,this.param.textLeft-4,b+this.param.trackHeight,8,{fill:"black",opacity:"0.2"}),e=a.text(c,this.param.textLeft-7,b+1.5*this.param.trackHeight-1,"-",{fontSize:"14",fill:"black",fontWeight:"bold"});b+=2.5*this.param.trackHeight;var f=a.createPath();a.path(c,f.move(this.param.textLeft-4,b-4).line([[this.param.textLeft-6,b],[this.param.textLeft-2,b]]).close(),{fill:"black",stroke:"black"});var g=a.rect(c,this.param.textLeft-5,b,2,this.param.trackHeight/2,{fill:"black"}),h="Currently showing all PDB matches. Click here to show only representatives.",i=[];i.push(d),i.push(e),i.push(f),i.push(g);for(var j=this,k=function(){j.viewer.setShowCondensed(!0),$("#showCondensed").text("Show All")},l=0;l<i.length;l++){var m=i[l];$(m).attr("title",h),this.registerTooltip(m),$(m).bind("click",k)}return b+this.param.trackHeight/2+1},e.prototype.drawSourceIndication=function(a,b,c,d){if(!(2>d-c)){var e=this.param.paired_colors,f=this.param.paired_colors[5].color,g=b;b.indexOf("Structural")>-1&&(g="SBKB"),"UniProtKB"===b?f=e[2].darkercolor:"PDB"===b||"validation"===b?f=e[1].darkercolor:"Pfam"===b?f=e[6].color:"Calculated"===b?(g="Calc",b="Electronic annotation",f="grey"):"Domains"===b?(g=" ",f=e[7].color):"Exon"===b?f=e[8].color:"Phospho"===b&&(f=e[9].color);var h=this.getGroup(b+this.viewer.getData().uniprotID);$(h).attr("font-weight",900);var i=a.rect(h,11,c,10,d-c,{fill:f,stroke:f,strokeWidth:1}),j="Data from: "+b;$(i).attr("title",j),this.registerTooltip(i);var k="rotate(-90,10,"+(d-this.param.trackHeight)+")",l=a.text(h,2,d-this.param.trackHeight+10,g,{transform:k,fill:"black","fill-opacity":"0.8"});$(l).attr("title",j),this.registerTooltip(l)}},e.prototype.drawSeparator=function(a,b){var c=a.group({id:"separator",fontWeight:"bold",fontSize:"10",fill:"black"});return a.rect(c,this.param.textLeft,b+this.param.trackHeight/4,Math.round(this.viewer.getSequence().length*this.scale)+this.leftBorder+this.rightBorder,1,{fill:"black",stroke:"black",strokeWidth:1}),b+this.param.trackHeight},e.prototype.drawGenericTrack=function(a,b,c,d,e,f,g,h,i){if("undefined"==typeof b)return c;if(0===b.length)return c;var j=0,k=this.getGroup(d+this.viewer.getData().uniprotID);this.drawName(a,k,c,d,void 0,i);for(var l=0;l<b.length;l++){var m=b[l];if("undefined"!=typeof m){for(var n=[],o=0;o<f.length;o++){var p=f[o],q=a.defs();a.linearGradient(q,e+"GR"+l+o+this.viewer.getData().uniprotID,[["0%","white"],["100%",p.darkercolor]],0,c,0,c+this.param.trackHeight,{gradientUnits:"userSpaceOnUse"});var r=this.getGroup(e+this.viewer.getData().uniprotID);$(r).attr("fill",p.textcolor),n[o]=r}a:for(var s=0;s<m.length;s++)try{var t=m[s];if("undefined"==typeof t.desc)continue a;if(-1===e.indexOf("scop")){if(t.desc.indexOf("Cytoplasmic")>-1){this.drawCytoplasmic(c,a,t,e);continue a}if(t.desc.indexOf("Periplasmic")>-1||t.desc.indexOf("Extracellular")>-1||t.desc.indexOf("Lumenal")>-1){this.drawPeriplasmic(c,a,t,e);continue a}if(t.name.indexOf("transmembrane")>-1){this.drawTransmembrane(c,a,t,e);continue a}if(t.name.indexOf("intramembrane")>-1){this.drawIntramembrane(c,a,t,e);continue a}}j++,j>=f.length&&(j=0);var u=f[j],v=n[j],w=t.end-t.start+1,x=this.seq2Screen(t.start-1),y=e+"GR"+l+j+this.viewer.getData().uniprotID,z=a.rect(v,x,c,w*this.scale,this.param.trackHeight,4,4,{fill:"url(#"+y+")",stroke:u.darkercolor,strokeWidth:1}),A=a.text(v,x+this.scale,c+this.param.trackHeight-1,t.desc);this.checkTxtLength(A,t.start,t.end,t.desc);var B=t.desc;t.desc!==t.name&&(B+="-"+t.name),"undefined"!=typeof t.status&&(B+=" - "+t.status),$(z).attr("title",B),this.registerTooltip(z),$(A).attr("title",B),this.registerTooltip(A),"undefined"!=typeof g&&($(z).css("cursor","pointer"),$(A).css("cursor","pointer"),$(z).bind("click",this.newLocationMethod),$(A).bind("click",this.newLocationMethod)),"undefined"!=typeof h&&($(z).css("cursor","pointer"),$(A).css("cursor","pointer"),$(z).bind("click",$.proxy(h,this,t)),$(A).bind("click",$.proxy(h,this,t)))}catch(C){alert("Problem while drawing generic track: "+d+" "+C)}c+=this.param.trackHeight+5}}return c},e.prototype.drawVariation=function(a,b){if("undefined"==typeof this.viewer.getData().variation)return b;if(this.viewer.getData().variation.tracks.length<1)return b;b+=7;var c=this.getGroup("variationTrackG"+this.viewer.getData().uniprotID);this.drawName(a,c,b,"Variation",void 0,this.viewer.getData().variation.label);var d=this.param.trackHeight+5,e=new Array(1);return e[0]=this.param.paired_colors[3],this.drawSiteResidues(a,this.viewer.getData().variation,b,"upVariationTrack"+this.viewer.getData().uniprotID,e,"up",d,this.popups.clickVariationMethod),b+d},e.prototype.drawUPSites=function(a,b){if("undefined"==typeof this.viewer.getData().upsites)return b;if(this.viewer.getData().upsites.tracks.length<1)return b;b+=2;var c=this.getGroup("upsitesTrackG"+this.viewer.getData().uniprotID);this.drawName(a,c,b,"UP Sites",void 0,this.viewer.getData().upsites.label);var d=this.param.trackHeight+5;return this.drawSiteResidues(a,this.viewer.getData().upsites,b,"upsitesTrack"+this.viewer.getData().uniprotID,this.param.paired_colors,"up",d,this.popups.clickUpSiteMethod),b+d},e.prototype.drawPhosphoSites=function(a,b){if("undefined"==typeof this.viewer.getData().phospho)return b;if(this.viewer.getData().phospho.tracks.length<1)return b;b+=5;var c=this.getGroup("phosphositesTrackG"+this.viewer.getData().uniprotID);this.drawName(a,c,b+this.param.trackHeight,"Phosphosite",void 0,this.viewer.getData().phospho.label);var d=this.param.trackHeight+5;return this.drawSiteResidues(a,this.viewer.getData().phospho,b,"phosphositesTrack"+this.viewer.getData().uniprotID,this.param.paired_colors,"up",d,this.popups.clickPhosphoMethod),b+d+22},e.prototype.drawPDBSites=function(a,b){if("undefined"==typeof this.viewer.getData().pdbsites)return b;if(this.viewer.getData().pdbsites.tracks.length<1)return b;var c=this.getGroup("sitesTrackG"+this.viewer.getData().uniprotID);this.drawName(a,c,b,"PDB Sites",void 0,this.viewer.getData().pdbsites.label);var d=this.param.trackHeight+5;return this.drawSiteResidues(a,this.viewer.getData().pdbsites,b,"sitesTrack"+this.viewer.getData().uniprotID,this.param.paired_colors,"down",d),b+d+2},e.prototype.drawRSRZOutlier=function(a,b,c,d,e){var f=this.param.baseLineHeight,g=this.param.trackHeight+5,h=this.param.paired_colors[5],i=a.rect(b,this.seq2Screen(c.start)-this.scale/2,e+f,2,g-f,{fill:"black"}),j=a.circle(b,this.seq2Screen(c.start)-this.scale/2,e,4,{fill:h.color,stroke:h.darkerColor,strokeWidth:1}),k="Poor fit to the electron density (RSRZ > 2) chain "+c.chainID+" PDB residue: "+c.pdbStart;$(i).attr("title",k),$(j).attr("title",k),this.registerTooltip(i),this.registerTooltip(j)},e.prototype.drawPDBValidation=function(a,c,d){if("undefined"==typeof this.viewer.getData().validation)return d;if(this.viewer.getData().validation.tracks.length<1)return d;for(var e="validationReport",f=this.getGroup("validationTrackG"+this.viewer.getData().uniprotID),g=a.defs(),h=this.param.paired_colors[5].color,i=b.rgb.hex2rgb(h),j=[b.forceRGB("darkgreen"),b.forceRGB("yellow"),b.forceRGB("orange"),i],k=0;k<j.length;k++){var l=j[k],m=b.rgb.rgb2hex(l),n=e+"GR"+k+this.viewer.getData().uniprotID;a.linearGradient(g,n,[["0%",m],["50%",m],["100%",m]],0,d,0,d+this.param.trackHeight,{gradientUnits:"userSpaceOnUse"})}this.drawName(a,f,d,"PDB Validation",void 0,this.viewer.getData().validation.label);for(var o=this.param.trackHeight+5,p=this.viewer.getData().validation.tracks,q=0;q<p.length;q++){var r=p[q];if("poorFit"!==r.name){r.desc=parseInt(r.desc),r.desc>3&&(r.desc=3);var s=e+"GR"+r.desc+this.viewer.getData().uniprotID,t=r.start-1,u=a.rect(this.seq2Screen(t),d+5,1*this.scale+1,this.param.trackHeight,{fill:"url(#"+s+")"});a.rect(this.seq2Screen(t),d+o,1*this.scale+1,1,{fill:"black"});var v=r.desc+" geometric outliers for "+r.pdbID+" residue "+r.pdbStart+"  in chain "+r.chainID;$(u).attr("title",v),this.registerTooltip(u)}}for(var w=a.group({id:"validationTrackOutlierG"+this.viewer.getData().uniprotID,fontWeight:"bold",fontSize:"10",fill:"black"}),x=0;x<p.length;x++){var y=p[x];"poorFit"===y.name&&this.drawRSRZOutlier(a,w,y,c,d)}return d+o+2},e.prototype.drawSCOP=function(a,c,d){if("undefined"==typeof this.viewer.getData().scop)return d;var e=this.breakTrackInRows(this.viewer.getData().scop.tracks);if(d=this.drawGenericTrack(a,e,d,"SCOP domains","scopDomains",b.rgb.getDomainColors(),void 0,this.popups.scopcallback,this.viewer.getData().scop.label),"undefined"==typeof this.viewer.getData().scope)return d;var f=this.breakTrackInRows(this.viewer.getData().scope.tracks);return d=this.drawGenericTrack(a,f,d,"SCOPe domains","scopeDomains",b.rgb.getDomainColors(),void 0,this.popups.scopecallback,this.viewer.getData().scope.label)},e.prototype.drawExons=function(a,b,c){if("undefined"==typeof this.viewer.getData().exon)return c;if(this.viewer.getData().exon.tracks.length<1)return c;c+=5;var d=this.param.trackHeight,e=this.getGroup("exonTrack"+this.viewer.getData().uniprotID);this.drawName(a,e,c,"Exon Structure",void 0,this.viewer.getData().exon.label);for(var f=0;f<this.viewer.getData().exon.tracks.length;f++){var g=this.viewer.getData().exon.tracks[f],h={};h.start=g.start,h.end=g.end,h.name=g.name,h.desc=g.desc;var i=this.seq2Screen(h.start-1),j=h.end-h.start+1,k=this.param.paired_colors[8],l=a.defs(),m=this.getGroup("exon"+f);f%2===0?a.linearGradient(l,"exon"+f,[["0%","white"],["100%",k.color]],0,c,0,c+d,{gradientUnits:"userSpaceOnUse"}):a.linearGradient(l,"exon"+f,[["0%",k.color],["100%","white"]],0,c,0,c+d,{gradientUnits:"userSpaceOnUse"});var n=a.rect(m,i,c,j*this.scale,d,0,0,{fill:"url(#exon"+f+")",stroke:k.darkercolor,strokeWidth:1}),o="Exon Structure "+h.name+" - "+h.desc;$(n).attr("title",o);var p=a.text(m,i+this.scale,c+this.param.trackHeight-1,h.name+" - "+h.desc);this.checkTxtLength(p,h.start,h.end,h.name),this.registerTooltip(n),$(p).attr("title","Exon Structure "+h.name+" - "+h.desc),this.registerTooltip(p)}return c+2*this.height},e.prototype.drawJronn=function(a,b,c){if("undefined"==typeof this.viewer.getData().jronn)return c;var d=this.getGroup("disorder"+this.viewer.getData().uniprotID);this.drawName(a,d,c+this.param.trackHeight,"Disorder",void 0,this.viewer.getData().jronn.label);for(var e=0,f=1,g=parseFloat(f+Math.abs(e)),h=(this.param.trackHeightCharts-2)/g,i=this.param.paired_colors[5],j=this.param.paired_colors[1],k=0;k<b.length;k++){var l=this.viewer.getData().jronn.tracks[k];if("undefined"!=typeof l){var m=Math.abs(parseFloat(l.desc)),n=m;m>=0&&(n+=Math.abs(e));var o=Math.abs(n)*h,p=j.color;m>.5&&(p=i.darkercolor);var q=o;a.rect(this.seq2Screen(k),c-o+this.param.trackHeightCharts-2,1*this.scale+1,q,{fill:p})}}return c+this.param.trackHeightCharts},e.prototype.drawHydropathy=function(a,b,c){if("undefined"==typeof this.viewer.getData().hydropathy)return c;var d=this.param.paired_colors[5],e=this.param.paired_colors[1],f=this.getGroup("hydropathy"+this.viewer.getData().uniprotID);this.drawName(a,f,c+this.param.trackHeight,"Hydropathy",void 0,this.viewer.getData().hydropathy.label),a.rect(f,this.seq2Screen(0),c+this.param.trackHeightCharts/2,b.length*this.scale,1,{fill:"black"});for(var g=parseFloat(this.viewer.getData().hydropathy_min),h=parseFloat(this.viewer.getData().hydropathy_max),i=h+Math.abs(g),j=this.param.trackHeightCharts/i,k=0;k<b.length;k++){var l=this.viewer.getData().hydropathy.tracks[k];if("undefined"!=typeof l){var m=parseFloat(l.desc),n=parseFloat(l.desc);m>0&&(n+=Math.abs(g));var o=Math.abs(n*j);if(0>m)a.rect(this.seq2Screen(k),c+this.param.trackHeightCharts/2,1*this.scale+1,o,{fill:e.color});else{var p=o-this.param.trackHeightCharts/2;0>p&&(p=0),a.rect(this.seq2Screen(k),c-o+this.param.trackHeightCharts,1*this.scale+1,p,{fill:d.color})}}}return c+this.param.trackHeightCharts+this.param.trackHeight/2},e.prototype.drawSignalP=function(a,b,c){return"undefined"==typeof this.viewer.getData().signalp?c:void(c=this.drawGenericTrack(a,this.viewer.getData().signalp,c,"SignalP","signalP",this.param.up_colors,void 0,this.callback,this.viewer.getData().signalp.label))},e.prototype.drawSelection=function(a,b){if(!(this.viewer.selectionStart<0)){"undefined"==typeof b&&(b=this.maxY);var c=0,d=a.group({id:"selection"+this.viewer.getData().uniprotID,fontWeight:"bold",fontSize:"10",border:this.param.paired_colors[6].color,fill:"white","fill-opacity":"0"}),e=this.viewer.selectionEnd-this.viewer.selectionStart+1,f=a.rect(d,this.seq2Screen(this.viewer.selectionStart),c,e*this.scale,b,0,0,{stroke:this.param.paired_colors[5].lightercolor,strokeWidth:1,style:"/* rule 1 */ use { fill-opacity: .5 } "});$(f).attr("data-toggle","tooltip"),$(f).attr("data-placement","top"),$(f).attr("data-container","body"),$(f).attr("title","selection: "+this.viewer.selectionStart+"-"+this.viewer.selectionEnd),$(f).text("selection: "+this.viewer.selectionStart+"-"+this.viewer.selectionEnd),$(f).tooltip()}},e.prototype.drawPfam=function(a,b){if("undefined"==typeof this.viewer.getData().pfam)return b;if(this.viewer.getData().pfam.tracks.length<1)return b;b+=5;var c=this.param.trackHeight,d=this.getGroup("pfamTrack"+this.viewer.getData().uniprotID);this.drawName(a,d,b,"Pfam",void 0,this.viewer.getData().pfam.label);for(var e=0;e<this.viewer.getData().pfam.tracks.length;e++){var f=this.viewer.getData().pfam.tracks[e],g={};g.start=f.start-1,g.end=f.end-1,g.name=f.name,g.desc=f.desc;var h=this.seq2Screen(g.start),i=g.end-g.start+1,j=this.param.paired_colors[6],k=a.defs(),l=this.getGroup("pfam"+e);$(l).attr("fill",j.textcolor),a.linearGradient(k,"pfam"+e,[["0%",j.lightercolor],["100%",j.darkercolor]],0,b,0,b+c,{gradientUnits:"userSpaceOnUse"});var m=a.rect(l,h,b,i*this.scale,c,3,3,{fill:"url(#pfam"+e+")",stroke:j.darkercolor,strokeWidth:1}),n="Pfam Domain "+g.name+" - "+g.desc;$(m).attr("title",n);var o=a.text(l,h+this.scale,b+this.param.trackHeight-1,g.name+" - "+g.desc);this.checkTxtLength(o,g.start,g.end,g.name),this.registerTooltip(m),$(o).attr("title","Pfam Domain "+g.name+" - "+g.desc),this.registerTooltip(o)}return b+this.height+5},e.prototype.highlightTrack=function(a,b,c,d){if(null===b)return c;var e=this.getGroup(d),f=this.viewer.getData().length;a.rect(e,0,c,this.param.leftBorder+Math.round(f*this.scale)+this.param.rightBorder,this.param.trackHeight,{fill:"lightgrey",stroke:"lightgrey",strokeWidth:1})},e.prototype.draw3dFlagForTrack=function(a,b,c){if(null===b)return c;var d="matrix(1,0,0,-1,0,"+(c+this.param.trackHeight)+") scale(0.005)",e=a.group({transform:d});a.path(e,this.icons.eye,{}),$(e).attr("title","Shown in 3D viewer"),this.registerTooltip(e)},e.prototype.drawTrack=function(a,b,c,d){if(null===b)return c;var e=this.getGroup(d),f=this.getGroup(d);$(f).attr("font-family","Helvetica, Arial, sans-serif"),$(f).attr("font-weight","bold");var g=a.group({id:"sMM"+d+this.viewer.getData().uniprotID,fontWeight:"bold",fontSize:"10",fill:this.param.paired_colors[5].color}),h=a.group({id:"seqres"+d,fontWeight:"bold",fontSize:"10",fill:"black"}),i=b.color,j=this.param.bw_colors[6],k=this.param.paired_colors[4],l=a.defs();a.linearGradient(l,"MyGradient"+d+this.viewer.getData().uniprotID,[["0%","white"],["100%",i]],0,c,0,c+this.param.trackHeight,{gradientUnits:"userSpaceOnUse"}),a.linearGradient(l,"BWGradient"+d+this.viewer.getData().uniprotID,[["0%","white"],["100%",j.color]],0,c,0,c+this.param.trackHeight,{gradientUnits:"userSpaceOnUse"}),a.linearGradient(l,"BWLightGradient"+d+this.viewer.getData().uniprotID,[["0%","white"],["100%","grey"]],0,c,0,c+this.param.trackHeight,{gradientUnits:"userSpaceOnUse"}),a.linearGradient(l,"MISMGradient"+d+this.viewer.getData().uniprotID,[["0%","white"],["100%",k.color]],0,c,0,c+this.param.trackHeight,{gradientUnits:"userSpaceOnUse"}),this.drawName(a,e,c,b.pdbID+"."+b.chainID,void 0,"Track for PDB ID "+b.pdbID+" chain ID "+b.chainID);for(var m=0;m<b.ranges.length;m++){var n=b.ranges[m],o={};o.start=n.start-1,o.end=n.end-1,o.observed=n.observed,o.mismatch=n.mismatch;var p=o.end-o.start+1,q=this.param.trackHeight/2-1,r=this.param.trackHeight/2-1;if(o.observed)if(o.mismatch){var s=a.rect(e,this.seq2Screen(o.start),c,Math.round(p*this.scale),this.param.trackHeight,{fill:"url(#MISMGradient"+d+this.viewer.getData().uniprotID+")",stroke:k.darkercolor,strokeWidth:1}),t=" (sequence position: "+n.start;n.start!==n.end&&(t+=" - "+n.end),t+=") ","undefined"!=typeof n.pdbStart&&(t+="(PDB residue:"+n.pdbStart,n.pdbStart!==n.pdbEnd&&(t+="-"+n.pdbEnd),t+=") ");var u="";"undefined"!=typeof n.pdbResidue&&(u=n.pdbResidue);var v="Mismatch "+this.viewer.getData().sequence.charAt(o.start)+"->"+u+" between PDB and UniProt residue "+t;if($(s).attr("title",v),this.registerTooltip(s),this.scale>8){var w=a.text(g,this.seq2Screen(o.start)+1,c+this.param.trackHeight-1,u);$(w).attr("title",v),this.registerTooltip(w)}}else{var x=a.rect(e,this.seq2Screen(o.start),c,Math.round(p*this.scale),this.param.trackHeight,q,r,{fill:"url(#MyGradient"+d+this.viewer.getData().uniprotID+")",stroke:i,strokeWidth:1}),y="";"undefined"!=typeof b.resolution&&(y=" - "+b.resolution/1e3+" Å");var z=new Date(b.releaseDate),A="PDB ID "+b.pdbID+" chain "+b.chainID+" - "+b.desc+" (sequence position: "+n.start+"-"+n.end+") ";if("undefined"!=typeof n.pdbStart&&(A+="(PDB residue: "+n.pdbStart,n.pdbEnd!==n.pdbStart&&(A+="-"+n.pdbEnd),A+=") "),A+=y+" - "+z.toDateString(),$(x).attr("title",A),this.registerTooltip(x),this.scale>8)for(var B=o.start;B<=o.end;B++){var C=this.viewer.getData().sequence.charAt(B);a.text(f,this.seq2Screen(B)+1,c+this.param.trackHeight-1,C)}}else if(this.viewer.getShowSeqres()){var D=e,E=this.param.trackHeight/4,F=this.param.trackHeight/4*2,G="url(#BWGradient";this.scale>8&&(D=h,E=0,F=this.param.trackHeight,G="url(#BWLightGradient");var H=a.rect(D,this.seq2Screen(o.start),c+E,Math.round(p*this.scale),F,{fill:G+d+this.viewer.getData().uniprotID+")",stroke:j.color,strokeWidth:1});if($(H).attr("title","No coordinates have been determined for region ("+o.start+"-"+o.end+"), but the sequence is recorded in the SEQRES records. "),this.registerTooltip(H),this.scale>8)for(var I=o.start;I<=o.end;I++){var J=this.viewer.getData().sequence.charAt(I).toLowerCase();a.text(D,this.seq2Screen(I)+2,c+this.param.trackHeight-1,J)}}}return"undefined"!=typeof b.seqdiff&&this.drawSeqDiff(a,b,c,d),c+this.height},e.prototype.drawSeqDiff=function(a,b,c,d){if("undefined"!=typeof b.seqdiff&&!(b.seqdiff.length<1))for(var e=0,g=this.param.up_colors,h=this.param.trackHeight,i=this.param.baseLineHeight,j=a.group({id:d,fontWeight:"bold",fontSize:"10",fill:"black"}),k=0;k<b.seqdiff.length;k++){var l=b.seqdiff[k];if("undefined"==typeof l.uniprot||l.uniprot===this.viewer.getData().uniprotID){var m="",n="";"undefined"!=typeof l.detail&&(m=l.detail.toUpperCase(),n=l.detail);var o=f[m];"undefined"!=typeof l.aa&&(n+=" "+l.aa),n+=" at "+l.pdbID+"."+l.chainID+" PDB residue:"+l.pdbStart+" sequence position: "+l.start,n+=" "+l.uniprot,"CONFLICT"===m&&(o=this.param.conflictColor);var p="",q=8,r=-3,s=0,t="circle";0===m.indexOf("MODIFIED")?(p=l.aa,q=6,r=-6):0===m.indexOf("MICROHETEROGENEITY")?(p="<>",q=6,r=-4,s=-1):0===m.indexOf("CLONING")?p="C":0===m.indexOf("GAP")?(p="",t="triangle"):0===m.indexOf("INITIAL METH")?(p=l.aa,r=-6,q=6):0===m.indexOf("CHROMOPHORE")?(p=l.aa,q=6,r=-6):0===m.indexOf("ENGINEERED")?p="E":m.indexOf("MUTATION")>-1?p="M":m.indexOf(" TAG")>-1?(p="T",o=this.param.expressionTagColor):m.indexOf("DELETION")>-1?(p="",t="triangle",o=this.param.deletionColor):m.indexOf("INSERTION")>-1&&(p="",t="triangle-up",o=this.param.deletionColor),"undefined"==typeof o&&(e++,e>g.length-1&&(e=0),o=g[e],f[m]=o);var u=this.seq2Screen(l.start)-this.scale/2;if(a.radialGradient(j,"seqDiffGradient"+k+this.viewer.getData().uniprotID,[["0%",o.lightercolor],["100%",o.color]],u,c+i-4,4,u,c+i-3,{gradientUnits:"userSpaceOnUse"}),"triangle"===t){u=this.seq2Screen(l.start)+this.scale/2;var v=this.scale/2,w=a.polygon(j,[[u-v,c-i],[u+1,c+i+2],[u+v+1,c-i]],{fill:"url(#seqDiffGradient"+k+this.viewer.getData().uniprotID+")",stroke:o.darkerColor,strokeWidth:1});$(w).attr("title",n),this.registerTooltip(w)}else if("triangle-up"===t){u=this.seq2Screen(l.start)+this.scale/2;var x=this.scale/2,y=a.polygon(j,[[u-x,c+i+2],[u+1,c-i],[u+x+1,c+i+2]],{fill:"url(#seqDiffGradient"+k+this.viewer.getData().uniprotID+")",stroke:o.darkerColor,strokeWidth:1});$(y).attr("title",n),this.registerTooltip(y)}else{var z=a.circle(j,u,c,4,{fill:"url(#seqDiffGradient"+k+this.viewer.getData().uniprotID+")",stroke:o.darkerColor,strokeWidth:1});$(z).attr("title",n),this.registerTooltip(z)}var A=a.rect(j,u,c+i,2,h-i,{fill:"black"});if($(A).attr("title",n),this.registerTooltip(A),p.length>0){var B=a.text(j,u+r,c+s+h/4,p,{"font-size":q});$(B).attr("title",n),this.registerTooltip(B)}}}},e.prototype.drawSiteResidues=function(a,b,c,d,e,g,h,i){if("undefined"!=typeof b.tracks&&!(b.tracks.length<1)){var j=this.param.baseLineHeight,k=0,l=a.group({id:d,fontWeight:"bold",fontSize:"10",fill:"black"}),m=a.defs(),n=!1,o=this.param.paired_colors[2];"PDB SITES residues"===b.label?o=this.param.paired_colors[1]:-1!==b.label.indexOf("Phosphosite")&&(o=this.param.paired_colors[9],n=!0);var p={};"up"===g?(a.linearGradient(m,"sequenceSite"+d+this.viewer.getData().uniprotID,[["0%",o.color],["100%",o.darkercolor]],0,c+h-j,0,c+h,{gradientUnits:"userSpaceOnUse"}),p=a.rect(l,this.seq2Screen(0),c+h-j,this.viewer.getSequence().length*this.scale,j,4,4,{fill:"url(#sequenceSite"+d+this.viewer.getData().uniprotID+")",stroke:o.darkercolor,strokeWidth:1})):(a.linearGradient(m,"sequenceSite"+d+this.viewer.getData().uniprotID,[["0%",o.color],["100%",o.darkercolor]],0,c,0,c+j,{gradientUnits:"userSpaceOnUse"}),p=a.rect(l,this.seq2Screen(0),c,this.viewer.getSequence().length*this.scale,j,4,4,{fill:"url(#sequenceSite"+d+this.viewer.getData().uniprotID+")",stroke:o.darkercolor,strokeWidth:1})),$(p).attr("title",b.label+" track for "+b.tracks[0].pdbID+"."+b.tracks[0].chainID),this.registerTooltip(p);for(var q=0;q<b.tracks.length;q++){var r=b.tracks[q];if("undefined"!=typeof r){var s=f[r.name];if("wwPDB validation report data"===b.label){var t=r.desc;s=t}"undefined"==typeof s&&(k++,k>e.length-1&&(k=0),s=e[k],f[r.name]=s),"up"===g?a.radialGradient(l,"siteWGradient"+q+this.viewer.getData().uniprotID,[["0%",s.lightercolor],["100%",s.color]],this.seq2Screen(r.start)-this.scale/2,c+j-4,4,this.seq2Screen(r.start)-this.scale/2,c+j-3,{gradientUnits:"userSpaceOnUse"}):a.radialGradient(l,"siteWGradient"+q+this.viewer.getData().uniprotID,[["0%",s.lightercolor],["100%",s.color]],this.seq2Screen(r.start)-this.scale/2,c+h-4,4,this.seq2Screen(r.start)-this.scale/2,c+h-3,{gradientUnits:"userSpaceOnUse"});var u={},v={};"up"===g?(u=a.rect(l,this.seq2Screen(r.start)-this.scale/2,c+j,2,h-j,{fill:"black"}),v=a.circle(l,this.seq2Screen(r.start)-this.scale/2,c,4,{fill:"url(#siteWGradient"+q+this.viewer.getData().uniprotID+")",stroke:s.darkerColor,strokeWidth:1})):(u=a.rect(l,this.seq2Screen(r.start)-this.scale/2,c,2,h,{fill:"black"}),v=a.circle(l,this.seq2Screen(r.start)-this.scale/2,c+h-4,4,{fill:"url(#siteWGradient"+q+this.viewer.getData().uniprotID+")",stroke:s.darkerColor,strokeWidth:1}));var w="";"string"==typeof b.tracks[0].pdbID&&(w=b.tracks[0].pdbID+"."+b.tracks[0].chainID+": ");var x=w;if("undefined"!=typeof r.desc&&(x+=r.desc),"undefined"!=typeof r.name&&(x+=" - "+r.name),x+=" ("+r.start+")",$(u).attr("title",x),this.registerTooltip(u),$(v).attr("title",x),"undefined"!==b.trackName&&"variation"===b.trackName){var y=r.externalLinks;"undefined"!=typeof y&&""!==y&&y.length>0&&$(v).data("extLinks",r.externalLinks)}this.registerTooltip(v),n&&($(v).attr("id",r.acc),$(v).attr("name",this.title)),"undefined"!=typeof i&&($(v).css("cursor","pointer"),$(v).bind("click",$.proxy(i,this,r)))}}}},e.prototype.drawUniprotChainData=function(a,b,c){var d=this.viewer.getData().chains,e=this.breakTrackInRows(d.tracks);return 1>e?b:b=this.drawGenericTrack(a,e,b,"Molec. Processing","chainTrack",this.param.up_colors,void 0,c,this.viewer.getData().chains.label)},e.prototype.drawTick=function(a,b,c,d){var e=a.group({fontWeight:"normal",fontSize:10,fill:"black"});a.text(e,this.seq2Screen(b),c-2-1,b+1+""),a.rect(this.seq2Screen(b),c,1*this.scale,d,{fill:"black"})},e.prototype.drawUniprotFeatures=function(a,b){var c=this.popups.callbackUniProtFeature;if("undefined"!=typeof this.viewer.getData().chains&&(b=this.drawUniprotChainData(a,b,c)),"undefined"!=typeof this.viewer.getData().motifs&&"undefined"!=typeof this.viewer.getData().motifs.tracks){var d=this.viewer.getData().motifs.tracks,e=this.breakTrackInRows(d);b=this.drawGenericTrack(a,e,b,"Motif","motifTrack",this.param.up_colors,void 0,c,this.viewer.getData().motifs.label)}if("undefined"!=typeof this.viewer.getData().enzymeClassification&&this.viewer.getData().enzymeClassification.tracks.length>0){var f=this.viewer.getData().enzymeClassification.tracks,g=this.breakTrackInRows(f);b=this.drawRangedTrack(a,g,b,"E.C.","enzymeClassificationTrack",this.param.up_colors,void 0,this.popups.callbackec,this.viewer.getData().enzymeClassification.label)}return b+this.param.trackHeight},e.prototype.drawPDBSecstruc=function(a,b){var c=this.viewer.getData().secstruc;return"undefined"==typeof c?b:(b=this.drawSecstrucTrack(a,c,b),b+this.param.trackHeight)},e.prototype.drawSecstrucTrack=function(a,b,c){if("undefined"==typeof b)return c;if("undefined"==typeof b.tracks)return c;var d=this.popups.callbackSecStruc,e="Secstruc",f=b.label,g=this.getGroup(f+this.viewer.getData().uniprotID);this.viewer.getData().tracks.length>0&&this.drawName(a,g,c,e,void 0,f);var h=this.param.bw_colors[0];a.linearGradient(a.defs(),"secstrucBWGradient"+this.viewer.getData().uniprotID,[["0%","white"],["100%",h]],0,c,0,c+this.param.trackHeight,{gradientUnits:"userSpaceOnUse"});for(var i=0;i<this.viewer.getData().tracks.length;i++){var j=this.viewer.getData().tracks[i];if(null!==j)for(var k=0;k<j.ranges.length;k++){var l=j.ranges[k];if(l.observed){var m={};m.start=l.start-1,m.end=l.end-1,m.name="secstruc",m.desc="coil";var n=m.end-m.start+1,o=a.rect(g,this.seq2Screen(m.start),c+this.param.trackHeight/4,Math.round(n*this.scale),this.param.trackHeight/4*2,{fill:"url(#secstrucBWGradient"+this.viewer.getData().uniprotID+")"});$(o).attr("title","coil"),this.registerTooltip(o),"undefined"!=typeof d&&($(o).css("cursor","pointer"),$(o).bind("click",$.proxy(d,this,m)))}}}for(var p=0;p<b.tracks.length;p++){var q=b.tracks[p],r={};r.start=q.start-1,r.end=q.end-1,r.name=q.name,r.desc=q.desc,r.note=q.note;var s=r.end-r.start+1;if(!(r.end>this.viewer.getData().length)){var t=this.param.bw_colors[3];"H"===r.name||"I"===r.name||"G"===r.name?t=this.param.paired_colors[5]:"E"===r.name||"B"===r.name?t=this.param.paired_colors[6]:"T"===r.name&&(t=this.param.paired_colors[0]);var u=this.seq2Screen(r.start),v=a.defs();a.linearGradient(v,e+"GR"+p+this.viewer.getData().uniprotID,[["0%",t.lightercolor],["100%",t.darkercolor]],0,c,0,c+this.param.trackHeight,{gradientUnits:"userSpaceOnUse"});var w=a.group({id:e+this.viewer.getData().uniprotID,fontWeight:"bold",fontSize:"10",fill:t.textcolor}),x={};if(x="H"===r.name||"G"===r.name||"I"===r.name||"E"===r.name?a.rect(w,u,c,s*this.scale,this.param.trackHeight,0,0,{fill:"url(#"+e+"GR"+p+this.viewer.getData().uniprotID+")",stroke:t.darkercolor,strokeWidth:1}):a.rect(g,u+1,c+this.param.trackHeight/8,s*this.scale,this.param.trackHeight/8*7,0,0,{fill:"url(#"+e+"GR"+p+this.viewer.getData().uniprotID+")",stroke:t.darkercolor,strokeWidth:1}),"H"===r.name)for(var y=u;y<this.seq2Screen(r.end);y+=4)a.line(g,y,c+this.param.trackHeight,y+4,c,{fill:t.darkercolor,stroke:t.darkercolor});var z=r.desc;"undefined"==typeof r.desc&&(z=r.name),"undefined"!=typeof r.note&&(z+=" (from "+r.note+")");var A=z+" ("+q.start+"-"+q.end+")";$(x).attr("title",A),"undefined"!=typeof d&&($(x).css("cursor","pointer"),$(x).bind("click",$.proxy(d,this,r)),this.registerTooltip(x))}}return c+this.param.trackHeight},e.prototype.drawRangedTrack=function(a,b,c,d,e,f,g,h,i){if(0===b.length)return c;var j=function(){document.location.href=g},k=-1,l=this.getGroup(d+this.viewer.getData().uniprotID);this.drawName(a,l,c,d,void 0,i);for(var m=0;m<b.length;m++){for(var n=b[m],o=0;o<n.length;o++)try{var p=n[o];if("undefined"==typeof p)continue;if("undefined"==typeof p.desc)continue;var q={};q.start=p.start-1,q.end=p.end-1,q.desc=p.desc,q.name=p.name,k++,k>f.length-1&&(k=0);var r=f[k],s=q.end-q.start+1,t=this.seq2Screen(q.start),u=a.defs();a.linearGradient(u,e+"GR"+m+o+this.viewer.getData().uniprotID,[["0%","white"],["100%",r.darkercolor]],0,c,0,c+this.param.trackHeight,{gradientUnits:"userSpaceOnUse"});var v=this.getGroup(e+this.viewer.getData().uniprotID);$(v).attr("fill",r.textcolor),a.rect(v,t,c,1*this.scale,this.param.trackHeight,1,1,{fill:r.darkercolor,stroke:r.darkercolor,strokeWidth:1}),a.rect(v,this.seq2Screen(q.end),c,1*this.scale,this.param.trackHeight,1,1,{fill:r.darkercolor,stroke:r.darkercolor,strokeWidth:1});var w=a.rect(v,t,c+this.param.trackHeight/2-2,s*this.scale,4,{fill:"url(#"+e+"GR"+m+o+this.viewer.getData().uniprotID+")",
stroke:r.darkercolor,strokeWidth:1}),x=q.desc;"Homology_Models"===e&&(x="");var y=a.text(v,t+this.scale,c+this.param.trackHeight-1,x);this.checkTxtLength(y,q.start,q.end,x);var z=q.name;z+=" ("+p.start+"-"+p.end+")",q.name!==q.desc&&(z+=" - "+q.desc),"undefined"!=typeof q.status&&(z+=" - "+q.status),$(w).attr("title",z),this.registerTooltip(w),$(y).attr("title",z),this.registerTooltip(y),"undefined"!=typeof g&&($(w).css("cursor","pointer"),$(y).css("cursor","pointer"),$(w).bind("click",j),$(y).bind("click",j)),"undefined"!=typeof h&&($(w).css("cursor","pointer"),$(y).css("cursor","pointer"),$(w).bind("click",$.proxy(h,this,q)),$(y).bind("click",$.proxy(h,this,q)))}catch(A){}c+=this.param.trackHeight+5}return c},e.prototype.drawCytoplasmic=function(a,b,c,d){var e=a+this.param.trackHeight-2,f=2;this.drawTmLine(a,b,c,d,e,f)},e.prototype.drawPeriplasmic=function(a,b,c,d){var e=a,f=2;this.drawTmLine(a,b,c,d,e,f)},e.prototype.drawTmLine=function(a,b,c,d,e,f){var g=this.param.paired_colors[1],h=this.getGroup(d+this.viewer.getData().uniprotID),i=c.end-c.start+1,j=this.seq2Screen(c.start-1),k=b.rect(h,j,e,i*this.scale,f,{fill:g.color,stroke:g.darkercolor,strokeWidth:1}),l=b.text(h,j+this.scale,a+this.param.trackHeight-1,c.desc);this.checkTxtLength(l,c.start,c.end,c.desc);var m=c.desc+"-"+c.name;"undefined"!=typeof c.status&&(m+=" - "+c.status),$(k).attr("title",m),this.registerTooltip(k),$(l).attr("title",m),this.registerTooltip(l)},e.prototype.drawIntramembrane=function(a,b,c,d){var e=this.param.bw_colors[3],f=this.getGroup(d+this.viewer.getData().uniprotID),g=c.end-c.start+1,h=this.seq2Screen(c.start-1),i=b.rect(f,h,a+this.param.trackHeight/2,g*this.scale,2,{fill:e.color,stroke:e.darkercolor,strokeWidth:1});b.rect(f,h,a,1*this.scale,this.param.trackHeight,1,1,{fill:e.darkercolor,stroke:e.darkercolor,strokeWidth:1}),b.rect(f,this.seq2Screen(c.end-1),a,1*this.scale,this.param.trackHeight,1,1,{fill:e.darkercolor,stroke:e.darkercolor,strokeWidth:1});var j=b.text(f,h+this.scale,a+this.param.trackHeight-1,c.desc);this.checkTxtLength(j,c.start,c.end,c.desc);var k=c.desc+"-"+c.name;"undefined"!=typeof c.status&&(k+=" - "+c.status),$(i).attr("title",k),this.registerTooltip(i),$(j).attr("title",k),this.registerTooltip(j)},e.prototype.drawTransmembrane=function(a,b,c,d){var e=this.param.paired_colors[5],f=e,g=this.getGroup(d+this.viewer.getData().uniprotID),h=c.end-c.start+1,i=this.seq2Screen(c.start-1),j=b.defs();b.linearGradient(j,d+"TR"+this.viewer.getData().uniprotID,[["0%",f.lightercolor],["100%",f.darkercolor]],0,a,0,a+this.param.trackHeight,{gradientUnits:"userSpaceOnUse"});for(var k=b.rect(g,i,a,h*this.scale,this.param.trackHeight,{fill:"url(#"+d+"TR"+this.viewer.getData().uniprotID+")",stroke:f.darkercolor,strokeWidth:1}),l=i;l<this.seq2Screen(c.end);l+=4)b.line(g,l,a+this.param.trackHeight,l+2,a,{fill:f.darkercolor,stroke:f.darkercolor});var m=b.text(g,i+this.scale,a+this.param.trackHeight-1,c.desc);this.checkTxtLength(m,c.start,c.end,c.desc);var n=c.desc+"-"+c.name;"undefined"!=typeof c.status&&(n+=" - "+c.status),$(k).attr("title",n),this.registerTooltip(k),$(m).attr("title",n),this.registerTooltip(m)},e.prototype.breakTrackInRows=function(a){var b=[];if(a.length<1)return b;var c=[];b.push(c);for(var d=0,e=0;e<a.length;e++){var f=a[e];if("undefined"!=typeof f){var g=0;a:for(var h=0;h<b.length;h++){for(var i=b[h],j=!1,k=0;k<i.length;k++){d++;var l=i[k],m=this.getOverlap(f.start,f.end,l.start,l.end);if(m>0){j=!0,g++;continue a}}if(!j)break a}if(b.length<g+1){var n=[];b.push(n)}b[g].push(f)}}return b},e.prototype.updateTrackColors=function(a){var b=0,c=-1,d=a;if("undefined"!=typeof this.viewer.getData().tracks)for(var e=0;e<this.viewer.getData().tracks.length;e++){var f=this.viewer.getData().tracks[e];if(null!==f){b++,c++,c>=d.length&&(c=0);var g=this.getTrackColor(d,c,f);f.color=g.color,f.lightercolor=g.lightercolor}}},e.prototype.getTrackColor=function(a,b,c){var d=a[b];if("Resolution"===this.viewer.colorBy){if("undefined"==typeof c.resolution)return this.param.bw_colors[6];for(var e=c.resolution,f=0;f<this.param.redblue_colors.length-1;f++)if(1e3*(f+1)>e)return this.param.redblue_colors[f];return this.param.redblue_colors[this.param.redblue_colors.length-1]}return"Alignment Length"===this.viewer.colorBy?a[1]:d},e.prototype.checkTxtLength=function(a,b,c,d){if("undefined"!=typeof d){var e=a.getComputedTextLength(),f=c-b+1,g=f*this.scale;if(e>g){var h=Math.floor(g/8);a.firstChild.data=d.substring(0,h)}}},e.prototype.getOverlap=function(a,b,c,d){var e=0;return(c>=a&&b>=c||d>=a&&b>=d||a>=c&&d>=b)&&(e=c>a?d>b?b-c:d-c:d>b?b-a:d-a),e},e.prototype.setScale=function(a){a>this.param.maxTextSize&&(a=this.param.maxTextSize),this.scale=a},e.prototype.registerTooltip=function(a,b){try{"undefined"==typeof b&&(b=$(a).attr("title")),"undefined"==typeof a&&console.err("got undefined for element?? "+b),"undefined"==typeof $(a)&&console.err("got undefined for element?? "+a+" "+b),$(a).attr({rel:"tooltip",title:b,"data-toggle":"tooltip","data-container":"body"}),$(a).css("cursor","pointer")}catch(c){}},{Draw:function(a){return new e(a)}}}),define("viewer",["colors","draw","params","icons","popups"],function(a,b,c,d,e){function f(){this.initClass();var a=this;$(window).resize(function(){$(a.parent).css("overflow","hidden"),$(a.parent).css("width","auto");var b=a.updateScale();b&&a.repaint()});var f=new b.Draw(this);this.drawer=f,this.params=c,this.icons=d,this.popups=new e.Popups,this.popups.init(this,this.rcsbServer)}function g(a,b){return a.pdbID===b.pdbID?a.chainID===b.chainID?0:a.chainID>b.chainID?1:-1:a.pdbID>b.pdbID?1:-1}function h(a,b){return 0===a||null===b?0:"undefined"==typeof a||"undefined"==typeof b?0:"undefined"==typeof a.resolution&&"undefined"==typeof b.resolution?0:"undefined"==typeof a.resolution&&"undefined"!=typeof b.resolution?1:"undefined"!=typeof a.resolution&&"undefined"==typeof b.resolution?-1:a.resolution===b.resolution?0:a.resolution>b.resolution?1:-1}function i(a,b){return a.releaseDate===b.releaseDate?0:a.releaseDate>b.releaseDate?1:-1}return f.prototype.initClass=function(){$.ajaxSetup({timeout:2e4}),this.data={},this.version="v. 1.0.1 build 284",this._initialized=!1,this.showCondensed=!0,this.colorBy="Alignment Length",this.defaultSort="Alignment Length",this.showSeqres=!0,this.singlePDBmode=!1,this.displayPDB="",this.addedPDB=[],this.contentDiv="#content",this.dialogDiv="#dialog",this.scrollBarDiv="#svgScrollBar",this.selectionStart=-1,this.selectionEnd=-1,this.masterURL="/pdb/protein/",this.rcsbServer="",this.listenerMap={},this.oldScale=-1,this.previousY=0,this.pdbIn3d="",this.chainIn3d="";try{$(this.scrollBarDiv).slider({handle:"round",enabled:"true",natural_arrow_keys:"true",formatter:function(a){return"zoom: "+a+"%"}})}catch(a){}this.startedAt=(new Date).getTime()},f.prototype.getVersion=function(){return this.version},f.prototype.setUniprotId=function(a){this.uniprotID=a},f.prototype.loadUniprot=function(a){if(this.uniprotID=a,"undefined"!=typeof a){this.data={};var b=this.rcsbServer+this.masterURL+this.uniprotID+"?type=json";if(this.singlePDBmode&&(b+="&display="+this.displayPDB),this.addedPDB.length>0){b+="&addPDB=";for(var c=0;c<this.addedPDB.length;c++)b+=this.addedPDB[c],c>0&&c<this.addedPDB.length-1&&(b+=",")}var d=this;$.getJSON(b,function(a){d.setData(a),$(d.parent).svg();var b=d.getSVGWrapper();d.drawInitial(b),d.updateScale(),d.repaint()}),this.registerEvents()}},f.prototype.registerEvents=function(){var a=this;$(this.parent).bind("click",$.proxy(function(b){var c=b.target.parentNode,d=c.id;if(""===d){var e=this.getSVGWrapper(),f=$(e.root()).offset(),g=b.pageX-f.left,h=this.drawer.screen2Seq(g)-1;h>this.data.sequence.length&&(h=-1),this.popups.showSequenceDialog(b)}if(d.indexOf("pfam")>-1){var i=d.substring(4,d.length);"track"!==i&&this.popups.showPfamDialog(a.data.pfam.tracks[i])}else if(d.indexOf("seq")>-1)this.popups.showSequenceDialog(b);else if(d.indexOf("exon")>-1){var j=d.substring(4,d.length);"track"!==j&&this.popups.showExonDialog(a.data.exon.tracks[j])}else if(d.indexOf("Secstruc")>-1);else if(d>=0){var k=this.data.tracks[d];this.popups.showDialog(k,b),this._dispatchEvent({name:"pdbTrackNameClicked"},"pdbTrackNameClicked",k)}},this)),$(this.scrollBarDiv).on("slide",$.proxy(this,"scrollValueChanged")),$(this.scrollBarDiv).on("slideStop",$.proxy(this,"scrollReleased"))},f.prototype.scrollValueChanged=function(){},f.prototype.scrollReleased=function(a){this.setScrollValue(a.value),this._dispatchEvent({name:"sliderReleased"},"sliderReleased",{percent:a.value})},f.prototype.setScrollValue=function(a){0>a?a=0:a>100&&(a=100);var b=this.getMinScale(),c=this.params.maxTextSize,d=c-b,e=b+d*(a/100);$(this.scrollBarDiv).slider().slider("setValue",a),this.setScale(e),this.repaint()},f.prototype.setMasterURL=function(a){this.masterURL=a},f.prototype.setTracks=function(a){this.asyncTracks=a},f.prototype.setDefaultTracks=function(){if(this.singlePDBmode?this.asyncTracks=[{name:"pdbsites",url:this.rcsbServer+"/pdb/protein/"+this.uniprotID+"?type=json&track=pdbsites&display="+this.displayPDB},{name:"SCOP",url:this.rcsbServer+"/pdb/protein/"+this.uniprotID+"?type=json&track=scop&display="+this.displayPDB},{name:"Validation",url:this.rcsbServer+"/pdb/protein/"+this.uniprotID+"?type=json&track=validation&display="+this.displayPDB}]:this.asyncTracks=[{name:"Exons",url:this.rcsbServer+"/pdb/protein/"+this.uniprotID+"?type=json&track=exons"},{name:"pfam",url:this.rcsbServer+"/pdb/protein/"+this.uniprotID+"?type=json&track=pfam"},{name:"pmp",url:this.rcsbServer+"/pdb/protein/"+this.uniprotID+"?type=json&track=pmp"},{name:"hydropathy",url:this.rcsbServer+"/pdb/protein/"+this.uniprotID+"?type=json&track=hydropathy"},{name:"Disorder",url:this.rcsbServer+"/pdb/protein/"+this.uniprotID+"?type=json&track=jronn"},{name:"SCOP",url:this.rcsbServer+"/pdb/protein/"+this.uniprotID+"?type=json&track=scop"},{name:"pdbsites",url:this.rcsbServer+"/pdb/protein/"+this.uniprotID+"?type=json&track=pdbsites"},{name:"phosporylation",url:this.rcsbServer+"/pdb/protein/"+this.uniprotID+"?type=json&track=phosphorylation"},{name:"variation",url:this.rcsbServer+"/pdb/protein/"+this.uniprotID+"?type=json&track=variation"}],!this.singlePDBmode&&this.addedPDB.length>0)for(var a=0;a<this.addedPDB.length;a++)this.asyncTracks.push({name:"pdbsites",url:this.rcsbServer+"/pdb/protein/"+this.uniprotID+"?type=json&track=pdbsites&display="+this.addedPDB[a]}),this.asyncTracks.push({name:"Validation",url:this.rcsbServer+"/pdb/protein/"+this.uniprotID+"?type=json&track=validation&display="+this.addedPDB[a]})},f.prototype.getData=function(){return this.data},f.prototype.setData=function(a){this.data=a,"undefined"==typeof this.asyncTracks&&this.setDefaultTracks(),this._initialized?this._dispatchEvent({name:"dataReloadedEvent"},"dataReloaded",this):(this._initialized=!0,this._dispatchEvent({name:"viewerReadyEvent"},"viewerReady",this));for(var b=function(a){g.parseJsonResponse(a)},c=function(a,b,c){0===a.status||404===a.status||500===a.status},d=0;d<this.asyncTracks.length;d++){var e=this.asyncTracks[d],f=e.url,g=this;$.ajax({url:f,dataType:"json",type:"GET",cache:!0,context:g,success:b,error:c,async:!0})}},f.prototype.loadURLAsync=function(a){var b=this;if(window.Worker){var c=new Worker("js/pfv/JsonWorker.js");c.onerror=function(a){c.postMessage({cmd:"stop"})},c.onmessage=function(a){var d=JSON.parse(a.data);b.parseJsonResponse(d.json),c.postMessage({cmd:"stop"})},c.postMessage({cmd:"load",msg:decodeURI(a)})}else $.ajax({url:a,dataType:"json",type:"GET",cache:!0,context:b,async:!0,success:function(a){b.parseJsonResponse(a)},error:function(a,b,c){0===a.status||404===a.status||500===a.status}})},f.prototype.parseJsonResponse=function(a){"undefined"!=typeof a.pfam?this.data.pfam=a.pfam:"undefined"!=typeof a.pmp?this.data.pmp=a.pmp:"undefined"!=typeof a.pdbsites?this.data.pdbsites=a.pdbsites:"undefined"!=typeof a.phosphorylation?this.data.phospho=a.phosphorylation:"undefined"!=typeof a.hydropathy?(this.data.hydropathy_max=a.hydropathy.hydropathy_max,this.data.hydropathy_min=a.hydropathy.hydropathy_min,this.data.hydropathy=a.hydropathy):"undefined"!=typeof a.jronn?(this.data.jronn_max=a.jronn.jronn_max,this.data.jronn_min=a.jronn.jronn_min,this.data.jronn=a.jronn):"undefined"!=typeof a.scop||"undefined"!=typeof a.scope?("undefined"!=typeof a.scop&&(this.data.scop=a.scop),"undefined"!=typeof a.scope&&(this.data.scope=a.scope)):"undefined"!=typeof a.exon?this.data.exon=a.exon:"undefined"!=typeof a.validation?this.data.validation=a.validation:"undefined"!=typeof a.variation&&(this.data.variation=a.variation),this.repaint()},f.prototype.getUniprotID=function(){return this.data.uniprotID},f.prototype.set3dViewFlag=function(a,b){this.pdbIn3d=a.toUpperCase(),this.chainIn3d=b,this.repaint()},f.prototype.showPDB=function(a){"undefined"!=typeof a&&(a.length>3?(this.singlePDBmode=!0,this.displayPDB=a.toUpperCase(),this.showCondensed=!1):0===a.length&&(this.singlePDBmode=!1,this.displayPDB="",this.showCondensed=!0))},f.prototype.addPDB=function(a){"undefined"!=typeof a&&a.length>3&&(this.addedPDB.push(a),this.showCondensed=!0)},f.prototype.trackShouldBeDisplayed=function(a){if(!this.showCondensed)return!0;if("undefined"!=typeof a.bestInCluster&&a.bestInCluster)return!0;var b=a.pdbID.toUpperCase();return b===this.displayPDB?!0:this.isAddedPDB(b)},f.prototype.isAddedPDB=function(a){for(var b=0;b<this.addedPDB.length;b++)if(this.addedPDB[b].toUpperCase()===a)return!0;return!1},f.prototype.showAll=function(a){this.singlePDBmode=a},f.prototype.setDialogDiv=function(a){this.dialogDiv=a},f.prototype.setScrollBarDiv=function(a){this.scrollBarDiv=a,$(this.scrollBarDiv).on("slide",$.proxy(this,"scrollValueChanged")),$(this.scrollBarDiv).on("mouseup",$.proxy(this,"scrollReleased"))},f.prototype.getScrollBarValue=function(){return $(this.scrollBarDiv).slider().slider("getValue")},f.prototype.setParentDiv=function(a){this.outerParent=a,this.contentDiv=a;var b=$("<div>");$(this.outerParent).append(b),this.parent=b},f.prototype.getParent=function(){return this.parent},f.prototype.getSVGWrapper=function(){return $(this.parent).svg("get")},f.prototype.reloadData=function(){var a="";"undefined"!=typeof this.data.paletteName&&(a="&palette="+this.data.paletteName);var b="/pdb/protein/"+this.uniprotID+"?type=json"+a;$.getJSON(b,function(a){this.data=a,this.repaint()})},f.prototype.reset=function(){$("#uniprotsubheader").html(""),this.svg=this.getSVGWrapper(),"undefined"!=typeof svg&&(this.svg.clear(),this.data={},this.hideColorLegend())},f.prototype.repaint=function(){if("undefined"!=typeof this.parent){$("#uniprotsubheader").html("");var a=this.getSVGWrapper();if("undefined"!=typeof a)try{a.clear(),this.drawInitial(a),this.drawer.maxY=this.y+this.params.bottomBorder,$(".tooltip").tooltip("hide")}catch(b){}}},f.prototype.doModal=function(a,b,c,d,e){var f='<div id="modalWindow" class="modal fade " tabindex="-1" role="dialog"  aria-hidden="true">';f+='<div class="modal-dialog">',f+='<div class="modal-content">',f+='<div class="modal-header">',f+='<a class="close" data-dismiss="modal">&times;</a>',f+="<h4>"+b+"</h4>",f+="</div>",f+='<div class="modal-body">',f+="<p>",f+=c,f+="</div>",f+='<div class="modal-footer">',""!==e&&(f+='<button class="btn btn-success"  data-dismiss="modal"',f+=' onClick="'+d+'; event.preventDefault();">'+e,f+="</button>"),f+='<button class="btn" data-dismiss="modal">Close',f+="</button>",f+="</div>",f+="</div></div>",f+="</div>",$(a).html(f),$("#modalWindow").modal(),$("#modalWindow").show()},f.prototype.hideModal=function(){$(".modal.in").modal("hide")},f.prototype.load3DChain=function(a,b){window.location=this.rcsbServer+"/pdb/explore/explore.do?structureId="+a},f.prototype.getPdbPositions=function(a,b){"undefined"==typeof b&&(b=a);for(var c=[],d=0;d<this.data.tracks.length;d++){var e=this.data.tracks[d];if("undefined"!=typeof e&&"undefined"!=typeof e.bestInCluster&&e.bestInCluster)for(var f=0;f<e.ranges.length;f++){var g=e.ranges[f],h={};h.start=g.start-1,h.end=g.end-1,h.observed=g.observed,h.mismatch=g.mismatch;var i=b;a===b&&i++;var j=this.drawer.getOverlap(a,i,h.start,h.end);if(j>0&&"undefined"!=typeof g.pdbStart){var k=Math.max(h.start,a),l=Math.min(h.end,b),m=0,n=0;a>h.start&&(m=a-h.start),b<h.end&&(n=h.end-b);var o={};o.seqPos=k,o.seqEnd=l,o.pdbStart=parseInt(g.pdbStart)+m,o.pdbEnd=parseInt(g.pdbEnd)-n,o.pdbId=e.pdbID,o.chainId=e.chainID,c.push(o)}}}return c},f.prototype.registerPdb3dLinks=function(a,b){for(var c=0;c<a.length;c++){var d=a[c],e="showIn3d"+d.pdbId;"undefined"!=typeof d.chainId&&(e+=d.chainId),"undefined"!=typeof d.pdbStart&&(e+=d.pdbStart),"undefined"!=typeof b&&(e+=b),$("#"+e).bind("click",$.proxy(this.show3dCallback,this,d))}},f.prototype.show3dCallback=function(a){this._dispatchEvent({name:"showPositionIn3d"},"showPositionIn3d",a),"undefined"!=typeof a.seqPos&&"undefined"!=typeof a.seqEnd?this.highlight(a.seqPos,a.seqEnd):this.highlight(-1,-1)},f.prototype.showPdb3dLinks=function(a,b){var c="";if(a.length<=0)return c;c+="<h3>Show in 3D on PDB structure</h3>";for(var d=0;d<a.length;d++){var e=a[d],f="showIn3d"+e.pdbId;"undefined"!=typeof e.chainId&&(f+=e.chainId),"undefined"!=typeof e.pdbStart&&(f+=e.pdbStart),"undefined"!=typeof b&&(f+=b),c+="<ul><li>Show in 3D on PDB <a href='#' id='"+f+"' data-dismiss='modal'>"+e.pdbId,"undefined"!=typeof e.chainId&&(c+="."+e.chainId),"undefined"!=typeof e.pdbStart&&(c+="("+e.pdbStart),"undefined"!=typeof e.pdbEnd&&e.pdbStart!==e.pdbEnd&&(c+="-"+e.pdbEnd),"undefined"!=typeof e.pdbStart&&(c+=")"),c+="</a></ul></li>"}return c},f.prototype.setZoomLevel=function(a){-1!==a.indexOf("whole")?this.updateScale():($(this.scrollBarDiv).slider().slider("setValue",100),this.setScale(this.params.maxTextSize)),this.repaint()},f.prototype.getPreferredWidth=function(){var a=$(this.contentDiv).width()-this.params.leftBorder-this.params.rightBorder,b=$(window).width()-this.params.leftBorder-this.params.rightBorder;return a>b&&(a=b),a},f.prototype.getMinScale=function(){var a=this.getPreferredWidth();return a/this.sequence.length},f.prototype.updateScale=function(){var a=1;if("undefined"!=typeof this.sequence){var b=this.getPreferredWidth();a=b/this.sequence.length,"undefined"!=typeof $(this.scrollBarDiv).slider()&&$(this.scrollBarDiv).slider().slider("setValue",0),$(this.parent).css("overflow","auto"),$(this.parent).css("width",$(this.outerParent).width())}else this.sequence={},this.sequence.length=this.data.length,this.sequence.name=this.data.uniprotID;return this.oldScale<0?(this.drawer.setScale(a),!0):this.oldScale===a?!1:(this.drawer.setScale(a),!0)},f.prototype.setScale=function(a){a>this.params.maxTextSize&&(a=this.params.maxTextSize),this.drawer.setScale(a),this.oldScale=a},f.prototype.resetSize=function(a,b,c){a.configure({width:b||$(a._container).width(),height:c||$(a._container).height()})},f.prototype.drawInitial=function(a){if("undefined"==typeof this.data.uniprotID)return void alert("Did not find a UniProt ID! "+JSON.stringify(this.data));var b=this.data,c=this.y;this.sequence={},this.sequence.length=b.length,this.sequence.name=b.uniprotID;var d=b.desc,e="<h1>Protein Feature View - "+b.uniprotID;e+=" ("+b.name+")","undefined"!=typeof d&&(e+=" - "+d),e+="</h1>",this.filterTracks();var f=b.uniprotID+" <span class='iconSet-main icon-external'  title='Link to UniProtKB entry. Up-to-date UniProt Ids are provided by the  SIFTS project (http://www.ebi.ac.uk/pdbe/docs/sifts)'> &nbsp;</span>";$("#linktouniprot").attr("href","http://www.uniprot.org/uniprot/"+b.uniprotID).attr("title","link to uniprot web site "+b.uniprotID).html(f);var g=this.rcsbServer+"/pdb/search/smart.do?smartComparator=and&smartSearchSubtype_0=UpAccessionIdQuery&target=Current&accessionIdList_0="+b.uniprotID;$("#searchinpdb").attr("href",g).attr("title","Find all matching PDB IDs for"+b.uniprotID).html("Search PDB"),$("#uniprotLength > span").html(b.length),$("#chainSummaryImage").hide(),$("#uniprotSpecies > span").html(b.species);var h=this.drawer;"undefined"!=typeof this.drawer&&(h.scale=this.drawer.scale),this.params=h.getParams(),h.scale<0&&this.updateScale(),c=h.height,h.drawSelection(a,this.previousY),this.singlePDBmode||(c=h.drawRuler(a,this.sequence,c));var i=c;c=h.drawSequence(a,this.sequence,c),c=h.drawUniprotFeatures(a,c),c=h.drawUPSites(a,c),c=h.drawVariation(a,c);var j=c;if(this.singlePDBmode||70>j-i&&(c=c-i+70,j=c),h.drawSourceIndication(a,"UniProtKB",i,j),!this.singlePDBmode){var k=c;c=h.drawPfam(a,c);var l=c;h.drawSourceIndication(a,"Pfam",k,l)}var m=c;c=h.drawPhosphoSites(a,c),h.drawSourceIndication(a,"Phospho",m,c);var n=c;c=h.drawSCOP(a,this.sequence,c),h.drawSourceIndication(a,"Domains",n,c);var o=c;c=h.drawJronn(a,this.sequence,c),c=h.drawHydropathy(a,this.sequence,c),c=h.drawSignalP(a,this.sequence,c),h.drawSourceIndication(a,"Calculated",o,c);var p=c;c=h.drawExons(a,this.sequence,c),h.drawSourceIndication(a,"Exon",p,c);var q=c;c=h.drawPDBSites(a,c),c=h.drawPDBSecstruc(a,c),c=h.drawPDBValidation(a,this.sequence,c),this.showCondensed||this.singlePDBmode||(c+=this.params.trackHeight,h.drawSourceIndication(a,"PDB",q,c),c=h.drawCollapseCondensedSymbol(a,c),q=c),this.sortTracks(this.defaultSort);for(var r=0,s=-1,t=[],u=0;u<b.tracks.length;u++){var v=b.tracks[u];null!==v&&t.push(v)}b.tracks=t;for(var w=0;w<b.tracks.length;w++){var x=b.tracks[w],y=x.pdbID.toUpperCase();if(this.isAddedPDB(y)&&h.highlightTrack(a,x,c,w),this.pdbIn3d===y&&this.chainIn3d===x.chainID&&h.draw3dFlagForTrack(a,x,c,w),this.singlePDBmode){if(x.pdbID!==this.displayPDB)continue;if(r>this.params.maxTracksSingleMode)continue}else if(this.showCondensed){var z=this.trackShouldBeDisplayed(x);if(!z)continue}r++,s++,s>=this.params.customColors.length&&(s=0);var A=h.getTrackColor(this.params.customColors,s,x);x.color=A.color,x.lightercolor=A.lightercolor,c=h.drawTrack(a,x,c,w)}var B=c;h.drawSourceIndication(a,"PDB",q,B);var C="Showing a representative subset of PDB matches. Click for more ",D=this,E=function(){"undefined"!=typeof pageTracker&&pageTracker._trackEvent("ProteinFeatureView","showCondensedView","true"),D.setShowCondensed(!1),$("#showCondensed").text("Show Condensed View")},F=this.getTotalNrPDBTracks();if(this.showCondensed&&!this.singlePDBmode&&F>1&&(c=h.drawExpandCondensedSymbol(a,B,C,E)),this.singlePDBmode){var G="Click here to view more details about "+b.uniprotID,H=function(){var a=D.rcsbServer+"/pdb/protein/"+b.uniprotID;""!==D.displayPDB&&(a+="?addPDB="+D.displayPDB),window.location=a};c=h.drawExpandCondensedSymbol(a,B,G,H)}else c=this.drawMultiPdbTracks(a,c,s);var I=b.length*h.scale+this.params.leftBorder+this.params.rightBorder;this.resetSize(a,I,c+this.params.bottomBorder);var J=this.getTotalNrPDBTracks();$("#clusterStats").html(r>0?J>r?"Showing "+r+" representative out of "+J+" PDB chains":"Showing all "+r+" PDB chains":"Showing all PDB entries"),this.y=c,this.previousY=c,$('[data-toggle="tooltip"]').tooltip()},f.prototype.drawMultiPdbTracks=function(b,c,d){var e=this.data,f=this.drawer,g=c;if("undefined"!=typeof e.pmp){c+=this.params.trackHeight;var h=e.pmp.label;h=h.replace(" ","_"),d++,d>=a.length&&(d=0);var i=e.pmp,j=f.breakTrackInRows(e.pmp.tracks),k="http://www.proteinmodelportal.org/query/up/"+e.uniprotID,l=function(){},m=this;"Homology Models from Protein Model Portal"===i.label&&(l=function(){"undefined"!=typeof pageTracker&&pageTracker._trackEvent("ProteinFeatureView","showPMPDialog",e.uniprotID);var a="<h3>"+this.desc+"</h3>";a+="<li>View all <a href='"+k+"' target='_new'>Homology Models at the Protein Model Portal</a></li>",a+="</ul>";var b="Protein Model Portal",c="",d="";m.doModal(m.dialogDiv,b,a,c,d)}),j.length>0&&(c="Homology Models from Protein Model Portal"===i.label?f.drawRangedTrack(b,j,c,"Homology Models","Homology_Models",this.params.homColors,void 0,l,i.label):f.drawGenericTrack(b,j,c,h,j[0].desc,this.params.homColors,k,void 0,i.label))}c+=this.params.trackHeight;var n=c;return 40>n-g&&(c=g+40,n=c),f.drawSourceIndication(b,"Structural Biology Knowledge Base",g,n),c},f.prototype.getTotalNrPDBTracks=function(){var a=this.data.tracks.length;return"undefined"!=typeof this.data.backupTracks&&(a=this.data.backupTracks.length),a},f.prototype.hideColorLegend=function(){$("#colorLegend").html("")},f.prototype.changeColorSelect=function(a){this.colorBy=a,"Resolution"===a?(this.hideColorLegend(),this.drawer.updateTrackColors(this.params.redblue_colors),this.repaint(),this.showColorLegend()):(this.hideColorLegend(),this.drawer.updateTrackColors(this.params.paired_colors),this.repaint())},f.prototype.setShowCondensed=function(a){var b=this.getTotalNrPDBTracks();2>b||(this.showCondensed=a,this.filterTracks(),this.repaint())},f.prototype.filterTracks=function(){var a=this.data;if(this.showCondensed){if("undefined"==typeof a.backupTracks&&(a.backupTracks=a.tracks),a.tracks.length<a.backupTracks.length)return;for(var b=[],c=0;c<a.backupTracks.length;c++){var d=a.backupTracks[c];"undefined"!=typeof d&&null!==d&&this.trackShouldBeDisplayed(d)&&b.push(d)}a.tracks=b}else"undefined"!=typeof a.backupTracks&&(a.tracks=a.backupTracks)},f.prototype.getShowCondensed=function(){return this.showCondensed},f.prototype.showColorLegend=function(){var a=this.data;if("undefined"!=typeof a.colors){for(var b=0;b<a.colors.length-1;b++){var c=a.colors[b],d=$("<div>").html("&nbsp;");$(d).attr("class","leftBox headerExt alignmentBox11"),$(d).css("background-color",c.color);var e=$("<div>").html(" Resolution < "+(b+1)+" &Aring;");$(e).append(d),$("#colorLegend").append(e),$("#colorLegend").append("<br/>")}var f=a.colors[a.colors.length-1],g=$("<div>").html("&nbsp;");$(g).attr("class","leftBox headerExt alignmentBox11"),$(g).css("background-color",f.color);var h=$("<div>").html(" Resolution >= "+b+" &Aring;");$(h).append(g),$("#colorLegend").append(h),$("#colorLegend").append("<br/>");var i=$("<div>").html("&nbsp;");$(i).attr("class","leftBox headerExt alignmentBox11"),$(i).css("background-color",this.bw_colors[6].color);var j=$("<div>").html(" no Resolution ");$(j).append(i),$("#colorLegend").append(j),$("#colorLegend").append("<br/>")}},f.prototype.getSequence=function(){return this.data.sequence},f.prototype.sortTracks=function(a){if("undefined"!=typeof this.data.tracks){if("Resolution"===a)try{this.data.tracks=$(this.data.tracks).sort(h)}catch(b){}else"Release Date"===a?this.data.tracks=$(this.data.tracks).sort(i):"Length"===a?this.data.tracks=$(this.data.tracks).sort(this.sortLength):"Alignment Length"===a?this.data.tracks=$(this.data.tracks).sort(this.sortAlignLength):this.data.tracks=$(this.data.tracks).sort(g);this.defaultSort=a}},$.fn.extend({sort:function(){return this.pushStack([].sort.apply(this,arguments),[])}}),f.prototype.sortLength=function(a,b){return a.length===b.length?0:a.length>b.length?-1:1},f.prototype.sortAlignLength=function(a,b){return null===a||null===b?0:"undefined"==typeof a.alignLength||"undefined"==typeof b.alignLength?0:null===a.alignLength||null===b.alignLength?0:a.alignLength===b.alignLength?0:a.alignLength>b.alignLength?-1:1},f.prototype.setPaletteName=function(a){this.data.paletteName=a,this.reloadData()},f.prototype.updatePalette=function(){$.each(this.data.palettes,function(a,b){$("#paletteselect").append($("<option></option>").attr("value",b).text(b))})},f.prototype.setShowSeqres=function(a){this.showSeqres=a,this._initialized&&this.repaint()},f.prototype.getShowSeqres=function(){return this.showSeqres},f.prototype.highlight=function(a,b){"undefined"==typeof b&&(b=a),(a!==this.selectionStart||this.seqposEnd!==this.selectionEnd)&&(this.selectionStart=a,this.selectionEnd=b,this.repaint(),this._dispatchEvent({name:"selectionChangedEvent"},"selectionChanged",this))},f.prototype.updateURL=function(a,b,c){var d=a,e="",f=d.split("?"),g=f[0],h=f[1],i="";if(h)for(var j=h.split("&"),k=0;k<j.length;k++)j[k].split("=")[0]!==b&&(e+=i+j[k],i="&");var l=i+""+b+"="+c,m=g+"?"+e+l;return m},f.prototype._dispatchEvent=function(a,b,c){var d=this.listenerMap[b];d&&d.forEach(function(b){b(c,a)})},f.prototype.addListener=function(a,b){var c=this.listenerMap[a];"undefined"==typeof c&&(c=[],this.listenerMap[a]=c),c.push(b),this._initialized&&"viewerReady"===a&&b(this,null)},f.prototype.setRcsbServer=function(a){this.rcsbServer=a},f.prototype.requestFullscreen=function(){var a=$(this.contentDiv).attr("id"),b=document.getElementById(a);$(b).css({width:"100%",height:"100%",padding:"5%",background:"white"}),b.requestFullscreen?b.requestFullscreen():b.msRequestFullscreen?b.msRequestFullscreen():b.mozRequestFullScreen?b.mozRequestFullScreen():b.webkitRequestFullscreen&&b.webkitRequestFullscreen(),this.updateScale(),this.repaint()},{PFV:function(a,b){return new f(a,b)}}});